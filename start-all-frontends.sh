#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–≤ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ Loya
# –ê–≤—Ç–æ—Ä: Loya Team
# –î–∞—Ç–∞: 15 –æ–∫—Ç—è–±—Ä—è 2024

echo "üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–≤ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ Loya..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "package.json" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ Loya"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
if [ ! -d "node_modules" ]; then
    echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
    npm install --legacy-peer-deps
fi

# –°–æ–±–∏—Ä–∞–µ–º shared –±–∏–±–ª–∏–æ—Ç–µ–∫—É
echo "üîß –°–±–æ—Ä–∫–∞ shared –±–∏–±–ª–∏–æ—Ç–µ–∫–∏..."
npm run build:shared

echo ""
echo "üéØ –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–≤:"
echo ""

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ —Ñ–æ–Ω–µ
start_frontend() {
    local name=$1
    local port=$2
    local command=$3
    
    echo "üì± –ó–∞–ø—É—Å–∫ $name –Ω–∞ –ø–æ—Ä—Ç—É $port..."
    (cd "frontends/$name" && $command > /dev/null 2>&1) &
    local pid=$!
    echo "   PID: $pid"
    sleep 2
}

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ã
start_frontend "client" "3001" "npm start"
start_frontend "cashier" "3002" "npm start"
start_frontend "venue-admin" "3003" "npm start"
start_frontend "tech-admin" "3004" "npm run dev"

echo ""
echo "‚úÖ –í—Å–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ã –∑–∞–ø—É—â–µ–Ω—ã!"
echo ""
echo "üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ URL:"
echo "   üì± –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:     http://localhost:3001"
echo "   üè™ –ö–∞—Å—Å–∏—Ä—Å–∫–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:     http://localhost:3002"
echo "   üè¢ –ê–¥–º–∏–Ω—Å–∫–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:      http://localhost:3003"
echo "   ‚öôÔ∏è  –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞–¥–º–∏–Ω–∫–∞:    http://localhost:3004"
echo ""
echo "üí° –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: Ctrl+C"
echo ""

# –ñ–¥–µ–º —Å–∏–≥–Ω–∞–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
trap 'echo ""; echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–≤..."; pkill -f "react-scripts\|next dev"; echo "‚úÖ –í—Å–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"; exit 0' INT

# –ñ–¥–µ–º –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
while true; do
    sleep 1
done
