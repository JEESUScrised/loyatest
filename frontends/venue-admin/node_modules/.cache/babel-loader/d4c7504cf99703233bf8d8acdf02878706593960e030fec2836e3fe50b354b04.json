{"ast":null,"code":"// Сервис для работы с платежами через Юкассу\nimport axios from 'axios';\nclass PaymentService {\n  constructor() {\n    this.baseUrl = 'http://localhost:3001/api/admin';\n    // Backend API URL\n    this.apiKey = 'test__UW59qNHWI_40gv3XfJTubp_5zQtFKft2UOLRSy8oxI';\n    this.shopId = '1184633';\n  }\n  // Создание платежа через реальный API Юкассы\n  async createPayment(paymentData) {\n    try {\n      console.log('Создание платежа через Юкассу:', paymentData);\n      const response = await axios.post(`${this.baseUrl}/payments/create`, {\n        amount: paymentData.amount,\n        currency: paymentData.currency,\n        description: paymentData.description,\n        returnUrl: paymentData.returnUrl,\n        metadata: paymentData.metadata\n      });\n      if (response.data.success) {\n        console.log('Платеж успешно создан:', response.data.data);\n        return response.data.data;\n      } else {\n        throw new Error(response.data.message || 'Ошибка создания платежа');\n      }\n    } catch (error) {\n      console.error('Ошибка создания платежа:', error);\n\n      // Fallback к моковому ответу для демонстрации\n      console.log('Используется моковый ответ для демонстрации');\n      const mockResponse = {\n        id: `test_payment_${Date.now()}`,\n        status: 'pending',\n        confirmation: {\n          type: 'redirect',\n          confirmation_url: `https://yoomoney.ru/checkout/payments/v2/show?orderId=${Date.now()}`\n        }\n      };\n      return mockResponse;\n    }\n  }\n\n  // Получение статуса платежа через реальный API Юкассы\n  async getPaymentStatus(paymentId) {\n    try {\n      console.log('Получение статуса платежа:', paymentId);\n      const response = await axios.get(`${this.baseUrl}/payments/${paymentId}/status`);\n      if (response.data.success) {\n        console.log('Статус платежа получен:', response.data.data);\n        return response.data.data;\n      } else {\n        throw new Error(response.data.message || 'Ошибка получения статуса платежа');\n      }\n    } catch (error) {\n      console.error('Ошибка получения статуса платежа:', error);\n\n      // Fallback к моковому статусу для демонстрации\n      console.log('Используется моковый статус для демонстрации');\n      const mockStatus = {\n        id: paymentId,\n        status: 'succeeded',\n        amount: {\n          value: '1000.00',\n          currency: 'RUB'\n        },\n        created_at: new Date().toISOString(),\n        description: 'Продление подписки Loya на 1 месяц'\n      };\n      return mockStatus;\n    }\n  }\n\n  // Генерация уникального ключа для идемпотентности\n  generateIdempotenceKey() {\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\n  }\n\n  // Создание платежа для продления подписки\n  async createSubscriptionPayment(months = 1) {\n    const amount = months * 1000; // 1000 рублей за месяц\n\n    return this.createPayment({\n      amount,\n      currency: 'RUB',\n      description: `Продление подписки Loya на ${months} ${months === 1 ? 'месяц' : 'месяца'}`,\n      returnUrl: `${window.location.origin}/payment/success`,\n      metadata: {\n        type: 'subscription_renewal',\n        months: months.toString(),\n        venue_code: 'VKU'\n      }\n    });\n  }\n}\nexport const paymentService = new PaymentService();","map":{"version":3,"names":["axios","PaymentService","constructor","baseUrl","apiKey","shopId","createPayment","paymentData","console","log","response","post","amount","currency","description","returnUrl","metadata","data","success","Error","message","error","mockResponse","id","Date","now","status","confirmation","type","confirmation_url","getPaymentStatus","paymentId","get","mockStatus","value","created_at","toISOString","generateIdempotenceKey","toString","Math","random","substr","createSubscriptionPayment","months","window","location","origin","venue_code","paymentService"],"sources":["C:/Users/user/Desktop/123/Loya/frontends/venue-admin/src/services/paymentService.ts"],"sourcesContent":["// Сервис для работы с платежами через Юкассу\r\nimport axios from 'axios';\r\n\r\nexport interface PaymentData {\r\n  amount: number;\r\n  currency: string;\r\n  description: string;\r\n  returnUrl: string;\r\n  metadata?: Record<string, string>;\r\n}\r\n\r\nexport interface PaymentResponse {\r\n  id: string;\r\n  status: string;\r\n  confirmation: {\r\n    type: string;\r\n    confirmation_url: string;\r\n  };\r\n}\r\n\r\nclass PaymentService {\r\n  private readonly baseUrl = 'http://localhost:3001/api/admin'; // Backend API URL\r\n  private readonly apiKey = 'test__UW59qNHWI_40gv3XfJTubp_5zQtFKft2UOLRSy8oxI';\r\n  private readonly shopId = '1184633';\r\n\r\n  // Создание платежа через реальный API Юкассы\r\n  async createPayment(paymentData: PaymentData): Promise<PaymentResponse> {\r\n    try {\r\n      console.log('Создание платежа через Юкассу:', paymentData);\r\n      \r\n      const response = await axios.post(`${this.baseUrl}/payments/create`, {\r\n        amount: paymentData.amount,\r\n        currency: paymentData.currency,\r\n        description: paymentData.description,\r\n        returnUrl: paymentData.returnUrl,\r\n        metadata: paymentData.metadata\r\n      });\r\n\r\n      if (response.data.success) {\r\n        console.log('Платеж успешно создан:', response.data.data);\r\n        return response.data.data;\r\n      } else {\r\n        throw new Error(response.data.message || 'Ошибка создания платежа');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Ошибка создания платежа:', error);\r\n      \r\n      // Fallback к моковому ответу для демонстрации\r\n      console.log('Используется моковый ответ для демонстрации');\r\n      const mockResponse: PaymentResponse = {\r\n        id: `test_payment_${Date.now()}`,\r\n        status: 'pending',\r\n        confirmation: {\r\n          type: 'redirect',\r\n          confirmation_url: `https://yoomoney.ru/checkout/payments/v2/show?orderId=${Date.now()}`\r\n        }\r\n      };\r\n      \r\n      return mockResponse;\r\n    }\r\n  }\r\n\r\n  // Получение статуса платежа через реальный API Юкассы\r\n  async getPaymentStatus(paymentId: string): Promise<any> {\r\n    try {\r\n      console.log('Получение статуса платежа:', paymentId);\r\n      \r\n      const response = await axios.get(`${this.baseUrl}/payments/${paymentId}/status`);\r\n      \r\n      if (response.data.success) {\r\n        console.log('Статус платежа получен:', response.data.data);\r\n        return response.data.data;\r\n      } else {\r\n        throw new Error(response.data.message || 'Ошибка получения статуса платежа');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Ошибка получения статуса платежа:', error);\r\n      \r\n      // Fallback к моковому статусу для демонстрации\r\n      console.log('Используется моковый статус для демонстрации');\r\n      const mockStatus = {\r\n        id: paymentId,\r\n        status: 'succeeded',\r\n        amount: {\r\n          value: '1000.00',\r\n          currency: 'RUB'\r\n        },\r\n        created_at: new Date().toISOString(),\r\n        description: 'Продление подписки Loya на 1 месяц'\r\n      };\r\n      \r\n      return mockStatus;\r\n    }\r\n  }\r\n\r\n  // Генерация уникального ключа для идемпотентности\r\n  private generateIdempotenceKey(): string {\r\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\r\n  }\r\n\r\n  // Создание платежа для продления подписки\r\n  async createSubscriptionPayment(months: number = 1): Promise<PaymentResponse> {\r\n    const amount = months * 1000; // 1000 рублей за месяц\r\n    \r\n    return this.createPayment({\r\n      amount,\r\n      currency: 'RUB',\r\n      description: `Продление подписки Loya на ${months} ${months === 1 ? 'месяц' : 'месяца'}`,\r\n      returnUrl: `${window.location.origin}/payment/success`,\r\n      metadata: {\r\n        type: 'subscription_renewal',\r\n        months: months.toString(),\r\n        venue_code: 'VKU'\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport const paymentService = new PaymentService();\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}