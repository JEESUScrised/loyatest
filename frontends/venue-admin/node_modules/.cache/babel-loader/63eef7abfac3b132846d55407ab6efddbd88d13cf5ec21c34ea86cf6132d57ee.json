{"ast":null,"code":"// Сервис для работы с платежами через Юкассу\n\nclass PaymentService {\n  constructor() {\n    this.backendUrl = 'http://localhost:5000/api/admin';\n  }\n  // Создание платежа через backend API\n  async createPayment(paymentData) {\n    try {\n      var _result$data$confirma;\n      const response = await fetch(`${this.backendUrl}/payments/create`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          amount: paymentData.amount,\n          currency: paymentData.currency,\n          description: paymentData.description,\n          returnUrl: paymentData.returnUrl,\n          metadata: paymentData.metadata\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const result = await response.json();\n      if (!result.success) {\n        throw new Error(result.message || 'Ошибка создания платежа');\n      }\n      console.log('Создан платеж через backend:', {\n        paymentId: result.data.id,\n        status: result.data.status,\n        confirmationUrl: (_result$data$confirma = result.data.confirmation) === null || _result$data$confirma === void 0 ? void 0 : _result$data$confirma.confirmation_url\n      });\n      return {\n        id: result.data.id,\n        status: result.data.status,\n        confirmation: {\n          type: result.data.confirmation.type,\n          confirmation_url: result.data.confirmation.confirmation_url\n        }\n      };\n    } catch (error) {\n      console.error('Ошибка создания платежа:', error);\n      throw new Error('Не удалось создать платеж. Пожалуйста, попробуйте еще раз.');\n    }\n  }\n\n  // Получение статуса платежа через backend API\n  async getPaymentStatus(paymentId) {\n    try {\n      const response = await fetch(`${this.backendUrl}/payments/${paymentId}/status`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const result = await response.json();\n      if (!result.success) {\n        throw new Error(result.message || 'Ошибка получения статуса платежа');\n      }\n      console.log('Получен статус платежа:', {\n        paymentId: result.data.id,\n        status: result.data.status,\n        amount: result.data.amount,\n        paid: result.data.paid\n      });\n      return result.data;\n    } catch (error) {\n      console.error('Ошибка получения статуса платежа:', error);\n      throw new Error('Не удалось получить статус платежа.');\n    }\n  }\n\n  // Генерация уникального ключа для идемпотентности\n  generateIdempotenceKey() {\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\n  }\n\n  // Создание платежа для продления подписки\n  async createSubscriptionPayment(months = 1) {\n    const amount = months * 1000; // 1000 рублей за месяц\n\n    return this.createPayment({\n      amount,\n      currency: 'RUB',\n      description: `Продление подписки Loya на ${months} ${months === 1 ? 'месяц' : 'месяца'}`,\n      returnUrl: `${window.location.origin}/payment/success`,\n      metadata: {\n        type: 'subscription_renewal',\n        months: months.toString(),\n        venue_code: 'VKU'\n      }\n    });\n  }\n}\nexport const paymentService = new PaymentService();","map":{"version":3,"names":["PaymentService","constructor","backendUrl","createPayment","paymentData","_result$data$confirma","response","fetch","method","headers","body","JSON","stringify","amount","currency","description","returnUrl","metadata","ok","Error","status","result","json","success","message","console","log","paymentId","data","id","confirmationUrl","confirmation","confirmation_url","type","error","getPaymentStatus","paid","generateIdempotenceKey","Date","now","toString","Math","random","substr","createSubscriptionPayment","months","window","location","origin","venue_code","paymentService"],"sources":["C:/Users/user/Desktop/loyaverse/Loya/frontends/venue-admin/src/services/paymentService.ts"],"sourcesContent":["// Сервис для работы с платежами через Юкассу\r\nexport interface PaymentData {\r\n  amount: number;\r\n  currency: string;\r\n  description: string;\r\n  returnUrl: string;\r\n  metadata?: Record<string, string>;\r\n}\r\n\r\nexport interface PaymentResponse {\r\n  id: string;\r\n  status: string;\r\n  confirmation: {\r\n    type: string;\r\n    confirmation_url: string;\r\n  };\r\n}\r\n\r\nclass PaymentService {\r\n  private readonly backendUrl = 'http://localhost:5000/api/admin';\r\n\r\n  // Создание платежа через backend API\r\n  async createPayment(paymentData: PaymentData): Promise<PaymentResponse> {\r\n    try {\r\n      const response = await fetch(`${this.backendUrl}/payments/create`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n          amount: paymentData.amount,\r\n          currency: paymentData.currency,\r\n          description: paymentData.description,\r\n          returnUrl: paymentData.returnUrl,\r\n          metadata: paymentData.metadata\r\n        })\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json();\r\n      \r\n      if (!result.success) {\r\n        throw new Error(result.message || 'Ошибка создания платежа');\r\n      }\r\n      \r\n      console.log('Создан платеж через backend:', {\r\n        paymentId: result.data.id,\r\n        status: result.data.status,\r\n        confirmationUrl: result.data.confirmation?.confirmation_url\r\n      });\r\n\r\n      return {\r\n        id: result.data.id,\r\n        status: result.data.status,\r\n        confirmation: {\r\n          type: result.data.confirmation.type,\r\n          confirmation_url: result.data.confirmation.confirmation_url\r\n        }\r\n      };\r\n    } catch (error) {\r\n      console.error('Ошибка создания платежа:', error);\r\n      throw new Error('Не удалось создать платеж. Пожалуйста, попробуйте еще раз.');\r\n    }\r\n  }\r\n\r\n  // Получение статуса платежа через backend API\r\n  async getPaymentStatus(paymentId: string): Promise<any> {\r\n    try {\r\n      const response = await fetch(`${this.backendUrl}/payments/${paymentId}/status`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json();\r\n      \r\n      if (!result.success) {\r\n        throw new Error(result.message || 'Ошибка получения статуса платежа');\r\n      }\r\n      \r\n      console.log('Получен статус платежа:', {\r\n        paymentId: result.data.id,\r\n        status: result.data.status,\r\n        amount: result.data.amount,\r\n        paid: result.data.paid\r\n      });\r\n\r\n      return result.data;\r\n    } catch (error) {\r\n      console.error('Ошибка получения статуса платежа:', error);\r\n      throw new Error('Не удалось получить статус платежа.');\r\n    }\r\n  }\r\n\r\n  // Генерация уникального ключа для идемпотентности\r\n  private generateIdempotenceKey(): string {\r\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\r\n  }\r\n\r\n  // Создание платежа для продления подписки\r\n  async createSubscriptionPayment(months: number = 1): Promise<PaymentResponse> {\r\n    const amount = months * 1000; // 1000 рублей за месяц\r\n    \r\n    return this.createPayment({\r\n      amount,\r\n      currency: 'RUB',\r\n      description: `Продление подписки Loya на ${months} ${months === 1 ? 'месяц' : 'месяца'}`,\r\n      returnUrl: `${window.location.origin}/payment/success`,\r\n      metadata: {\r\n        type: 'subscription_renewal',\r\n        months: months.toString(),\r\n        venue_code: 'VKU'\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport const paymentService = new PaymentService();\r\n"],"mappings":"AAAA;;AAkBA,MAAMA,cAAc,CAAC;EAAAC,YAAA;IAAA,KACFC,UAAU,GAAG,iCAAiC;EAAA;EAE/D;EACA,MAAMC,aAAaA,CAACC,WAAwB,EAA4B;IACtE,IAAI;MAAA,IAAAC,qBAAA;MACF,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG,IAAI,CAACL,UAAU,kBAAkB,EAAE;QACjEM,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UACP,cAAc,EAAE;QAClB,CAAC;QACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UACnBC,MAAM,EAAET,WAAW,CAACS,MAAM;UAC1BC,QAAQ,EAAEV,WAAW,CAACU,QAAQ;UAC9BC,WAAW,EAAEX,WAAW,CAACW,WAAW;UACpCC,SAAS,EAAEZ,WAAW,CAACY,SAAS;UAChCC,QAAQ,EAAEb,WAAW,CAACa;QACxB,CAAC;MACH,CAAC,CAAC;MAEF,IAAI,CAACX,QAAQ,CAACY,EAAE,EAAE;QAChB,MAAM,IAAIC,KAAK,CAAC,uBAAuBb,QAAQ,CAACc,MAAM,EAAE,CAAC;MAC3D;MAEA,MAAMC,MAAM,GAAG,MAAMf,QAAQ,CAACgB,IAAI,CAAC,CAAC;MAEpC,IAAI,CAACD,MAAM,CAACE,OAAO,EAAE;QACnB,MAAM,IAAIJ,KAAK,CAACE,MAAM,CAACG,OAAO,IAAI,yBAAyB,CAAC;MAC9D;MAEAC,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAE;QAC1CC,SAAS,EAAEN,MAAM,CAACO,IAAI,CAACC,EAAE;QACzBT,MAAM,EAAEC,MAAM,CAACO,IAAI,CAACR,MAAM;QAC1BU,eAAe,GAAAzB,qBAAA,GAAEgB,MAAM,CAACO,IAAI,CAACG,YAAY,cAAA1B,qBAAA,uBAAxBA,qBAAA,CAA0B2B;MAC7C,CAAC,CAAC;MAEF,OAAO;QACLH,EAAE,EAAER,MAAM,CAACO,IAAI,CAACC,EAAE;QAClBT,MAAM,EAAEC,MAAM,CAACO,IAAI,CAACR,MAAM;QAC1BW,YAAY,EAAE;UACZE,IAAI,EAAEZ,MAAM,CAACO,IAAI,CAACG,YAAY,CAACE,IAAI;UACnCD,gBAAgB,EAAEX,MAAM,CAACO,IAAI,CAACG,YAAY,CAACC;QAC7C;MACF,CAAC;IACH,CAAC,CAAC,OAAOE,KAAK,EAAE;MACdT,OAAO,CAACS,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;MAChD,MAAM,IAAIf,KAAK,CAAC,4DAA4D,CAAC;IAC/E;EACF;;EAEA;EACA,MAAMgB,gBAAgBA,CAACR,SAAiB,EAAgB;IACtD,IAAI;MACF,MAAMrB,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG,IAAI,CAACL,UAAU,aAAayB,SAAS,SAAS,EAAE;QAC9EnB,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;UACP,cAAc,EAAE;QAClB;MACF,CAAC,CAAC;MAEF,IAAI,CAACH,QAAQ,CAACY,EAAE,EAAE;QAChB,MAAM,IAAIC,KAAK,CAAC,uBAAuBb,QAAQ,CAACc,MAAM,EAAE,CAAC;MAC3D;MAEA,MAAMC,MAAM,GAAG,MAAMf,QAAQ,CAACgB,IAAI,CAAC,CAAC;MAEpC,IAAI,CAACD,MAAM,CAACE,OAAO,EAAE;QACnB,MAAM,IAAIJ,KAAK,CAACE,MAAM,CAACG,OAAO,IAAI,kCAAkC,CAAC;MACvE;MAEAC,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAE;QACrCC,SAAS,EAAEN,MAAM,CAACO,IAAI,CAACC,EAAE;QACzBT,MAAM,EAAEC,MAAM,CAACO,IAAI,CAACR,MAAM;QAC1BP,MAAM,EAAEQ,MAAM,CAACO,IAAI,CAACf,MAAM;QAC1BuB,IAAI,EAAEf,MAAM,CAACO,IAAI,CAACQ;MACpB,CAAC,CAAC;MAEF,OAAOf,MAAM,CAACO,IAAI;IACpB,CAAC,CAAC,OAAOM,KAAK,EAAE;MACdT,OAAO,CAACS,KAAK,CAAC,mCAAmC,EAAEA,KAAK,CAAC;MACzD,MAAM,IAAIf,KAAK,CAAC,qCAAqC,CAAC;IACxD;EACF;;EAEA;EACQkB,sBAAsBA,CAAA,EAAW;IACvC,OAAOC,IAAI,CAACC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,GAAGC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACF,QAAQ,CAAC,EAAE,CAAC,CAACG,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC;EACxE;;EAEA;EACA,MAAMC,yBAAyBA,CAACC,MAAc,GAAG,CAAC,EAA4B;IAC5E,MAAMhC,MAAM,GAAGgC,MAAM,GAAG,IAAI,CAAC,CAAC;;IAE9B,OAAO,IAAI,CAAC1C,aAAa,CAAC;MACxBU,MAAM;MACNC,QAAQ,EAAE,KAAK;MACfC,WAAW,EAAE,8BAA8B8B,MAAM,IAAIA,MAAM,KAAK,CAAC,GAAG,OAAO,GAAG,QAAQ,EAAE;MACxF7B,SAAS,EAAE,GAAG8B,MAAM,CAACC,QAAQ,CAACC,MAAM,kBAAkB;MACtD/B,QAAQ,EAAE;QACRgB,IAAI,EAAE,sBAAsB;QAC5BY,MAAM,EAAEA,MAAM,CAACL,QAAQ,CAAC,CAAC;QACzBS,UAAU,EAAE;MACd;IACF,CAAC,CAAC;EACJ;AACF;AAEA,OAAO,MAAMC,cAAc,GAAG,IAAIlD,cAAc,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}