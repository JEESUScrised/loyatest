{"ast":null,"code":"// Сервис для работы с платежами через Юкассу\n\nclass PaymentService {\n  constructor() {\n    this.apiKey = 'test__UW59qNHWI_40gv3XfJTubp_5zQtFKft2UOLRSy8oxI';\n    this.shopId = '1184633';\n    this.baseUrl = 'https://api.yookassa.ru/v3';\n  }\n  // Создание платежа (моковая версия для демонстрации)\n  async createPayment(paymentData) {\n    // Имитируем задержку API\n    await new Promise(resolve => setTimeout(resolve, 1000));\n\n    // Моковый ответ от Юкассы\n    const mockResponse = {\n      id: `test_payment_${Date.now()}`,\n      status: 'pending',\n      confirmation: {\n        type: 'redirect',\n        confirmation_url: `https://yoomoney.ru/checkout/payments/v2/show?orderId=${Date.now()}`\n      }\n    };\n    console.log('Создан тестовый платеж:', {\n      amount: paymentData.amount,\n      currency: paymentData.currency,\n      description: paymentData.description,\n      paymentId: mockResponse.id\n    });\n    return mockResponse;\n  }\n\n  // Получение статуса платежа\n  async getPaymentStatus(paymentId) {\n    try {\n      const response = await fetch(`${this.baseUrl}/payments/${paymentId}`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Basic ${btoa(`${this.shopId}:${this.apiKey}`)}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('Ошибка получения статуса платежа:', error);\n      throw error;\n    }\n  }\n\n  // Генерация уникального ключа для идемпотентности\n  generateIdempotenceKey() {\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\n  }\n\n  // Создание платежа для продления подписки\n  async createSubscriptionPayment(months = 1) {\n    const amount = months * 1000; // 1000 рублей за месяц\n\n    return this.createPayment({\n      amount,\n      currency: 'RUB',\n      description: `Продление подписки Loya на ${months} ${months === 1 ? 'месяц' : 'месяца'}`,\n      returnUrl: `${window.location.origin}/payment/success`,\n      metadata: {\n        type: 'subscription_renewal',\n        months: months.toString(),\n        venue_code: 'VKU'\n      }\n    });\n  }\n}\nexport const paymentService = new PaymentService();","map":{"version":3,"names":["PaymentService","constructor","apiKey","shopId","baseUrl","createPayment","paymentData","Promise","resolve","setTimeout","mockResponse","id","Date","now","status","confirmation","type","confirmation_url","console","log","amount","currency","description","paymentId","getPaymentStatus","response","fetch","method","headers","btoa","ok","Error","json","error","generateIdempotenceKey","toString","Math","random","substr","createSubscriptionPayment","months","returnUrl","window","location","origin","metadata","venue_code","paymentService"],"sources":["C:/Users/user/Desktop/loyaverse/Loya/frontends/venue-admin/src/services/paymentService.ts"],"sourcesContent":["// Сервис для работы с платежами через Юкассу\r\nexport interface PaymentData {\r\n  amount: number;\r\n  currency: string;\r\n  description: string;\r\n  returnUrl: string;\r\n  metadata?: Record<string, string>;\r\n}\r\n\r\nexport interface PaymentResponse {\r\n  id: string;\r\n  status: string;\r\n  confirmation: {\r\n    type: string;\r\n    confirmation_url: string;\r\n  };\r\n}\r\n\r\nclass PaymentService {\r\n  private readonly apiKey = 'test__UW59qNHWI_40gv3XfJTubp_5zQtFKft2UOLRSy8oxI';\r\n  private readonly shopId = '1184633';\r\n  private readonly baseUrl = 'https://api.yookassa.ru/v3';\r\n\r\n  // Создание платежа (моковая версия для демонстрации)\r\n  async createPayment(paymentData: PaymentData): Promise<PaymentResponse> {\r\n    // Имитируем задержку API\r\n    await new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\n    // Моковый ответ от Юкассы\r\n    const mockResponse: PaymentResponse = {\r\n      id: `test_payment_${Date.now()}`,\r\n      status: 'pending',\r\n      confirmation: {\r\n        type: 'redirect',\r\n        confirmation_url: `https://yoomoney.ru/checkout/payments/v2/show?orderId=${Date.now()}`\r\n      }\r\n    };\r\n\r\n    console.log('Создан тестовый платеж:', {\r\n      amount: paymentData.amount,\r\n      currency: paymentData.currency,\r\n      description: paymentData.description,\r\n      paymentId: mockResponse.id\r\n    });\r\n\r\n    return mockResponse;\r\n  }\r\n\r\n  // Получение статуса платежа\r\n  async getPaymentStatus(paymentId: string): Promise<any> {\r\n    try {\r\n      const response = await fetch(`${this.baseUrl}/payments/${paymentId}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Basic ${btoa(`${this.shopId}:${this.apiKey}`)}`,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Ошибка получения статуса платежа:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Генерация уникального ключа для идемпотентности\r\n  private generateIdempotenceKey(): string {\r\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\r\n  }\r\n\r\n  // Создание платежа для продления подписки\r\n  async createSubscriptionPayment(months: number = 1): Promise<PaymentResponse> {\r\n    const amount = months * 1000; // 1000 рублей за месяц\r\n    \r\n    return this.createPayment({\r\n      amount,\r\n      currency: 'RUB',\r\n      description: `Продление подписки Loya на ${months} ${months === 1 ? 'месяц' : 'месяца'}`,\r\n      returnUrl: `${window.location.origin}/payment/success`,\r\n      metadata: {\r\n        type: 'subscription_renewal',\r\n        months: months.toString(),\r\n        venue_code: 'VKU'\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport const paymentService = new PaymentService();\r\n"],"mappings":"AAAA;;AAkBA,MAAMA,cAAc,CAAC;EAAAC,YAAA;IAAA,KACFC,MAAM,GAAG,kDAAkD;IAAA,KAC3DC,MAAM,GAAG,SAAS;IAAA,KAClBC,OAAO,GAAG,4BAA4B;EAAA;EAEvD;EACA,MAAMC,aAAaA,CAACC,WAAwB,EAA4B;IACtE;IACA,MAAM,IAAIC,OAAO,CAACC,OAAO,IAAIC,UAAU,CAACD,OAAO,EAAE,IAAI,CAAC,CAAC;;IAEvD;IACA,MAAME,YAA6B,GAAG;MACpCC,EAAE,EAAE,gBAAgBC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;MAChCC,MAAM,EAAE,SAAS;MACjBC,YAAY,EAAE;QACZC,IAAI,EAAE,UAAU;QAChBC,gBAAgB,EAAE,yDAAyDL,IAAI,CAACC,GAAG,CAAC,CAAC;MACvF;IACF,CAAC;IAEDK,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAE;MACrCC,MAAM,EAAEd,WAAW,CAACc,MAAM;MAC1BC,QAAQ,EAAEf,WAAW,CAACe,QAAQ;MAC9BC,WAAW,EAAEhB,WAAW,CAACgB,WAAW;MACpCC,SAAS,EAAEb,YAAY,CAACC;IAC1B,CAAC,CAAC;IAEF,OAAOD,YAAY;EACrB;;EAEA;EACA,MAAMc,gBAAgBA,CAACD,SAAiB,EAAgB;IACtD,IAAI;MACF,MAAME,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG,IAAI,CAACtB,OAAO,aAAamB,SAAS,EAAE,EAAE;QACpEI,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;UACP,eAAe,EAAE,SAASC,IAAI,CAAC,GAAG,IAAI,CAAC1B,MAAM,IAAI,IAAI,CAACD,MAAM,EAAE,CAAC,EAAE;UACjE,cAAc,EAAE;QAClB;MACF,CAAC,CAAC;MAEF,IAAI,CAACuB,QAAQ,CAACK,EAAE,EAAE;QAChB,MAAM,IAAIC,KAAK,CAAC,uBAAuBN,QAAQ,CAACX,MAAM,EAAE,CAAC;MAC3D;MAEA,OAAO,MAAMW,QAAQ,CAACO,IAAI,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdf,OAAO,CAACe,KAAK,CAAC,mCAAmC,EAAEA,KAAK,CAAC;MACzD,MAAMA,KAAK;IACb;EACF;;EAEA;EACQC,sBAAsBA,CAAA,EAAW;IACvC,OAAOtB,IAAI,CAACC,GAAG,CAAC,CAAC,CAACsB,QAAQ,CAAC,CAAC,GAAGC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACF,QAAQ,CAAC,EAAE,CAAC,CAACG,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC;EACxE;;EAEA;EACA,MAAMC,yBAAyBA,CAACC,MAAc,GAAG,CAAC,EAA4B;IAC5E,MAAMpB,MAAM,GAAGoB,MAAM,GAAG,IAAI,CAAC,CAAC;;IAE9B,OAAO,IAAI,CAACnC,aAAa,CAAC;MACxBe,MAAM;MACNC,QAAQ,EAAE,KAAK;MACfC,WAAW,EAAE,8BAA8BkB,MAAM,IAAIA,MAAM,KAAK,CAAC,GAAG,OAAO,GAAG,QAAQ,EAAE;MACxFC,SAAS,EAAE,GAAGC,MAAM,CAACC,QAAQ,CAACC,MAAM,kBAAkB;MACtDC,QAAQ,EAAE;QACR7B,IAAI,EAAE,sBAAsB;QAC5BwB,MAAM,EAAEA,MAAM,CAACL,QAAQ,CAAC,CAAC;QACzBW,UAAU,EAAE;MACd;IACF,CAAC,CAAC;EACJ;AACF;AAEA,OAAO,MAAMC,cAAc,GAAG,IAAI/C,cAAc,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}