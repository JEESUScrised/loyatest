{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback } from 'react';\nimport { apiClient } from '../services/apiClient';\nexport const useAuth = () => {\n  _s();\n  const [authState, setAuthState] = useState({\n    user: null,\n    isAuthenticated: false,\n    isLoading: true,\n    error: null\n  });\n\n  // Регистрация пользователя\n  const register = useCallback(async telegramData => {\n    try {\n      setAuthState(prev => ({\n        ...prev,\n        isLoading: true,\n        error: null\n      }));\n      const response = await apiClient.post('/user/register', telegramData);\n      if (response.success && response.data) {\n        // Сохраняем токен\n        localStorage.setItem('auth_token', response.data.token);\n        apiClient.setAuthToken(response.data.token);\n\n        // Получаем профиль пользователя\n        await fetchProfile();\n      }\n    } catch (error) {\n      setAuthState(prev => ({\n        ...prev,\n        isLoading: false,\n        error: error.message || 'Ошибка регистрации'\n      }));\n    }\n  }, []);\n\n  // Получение профиля пользователя\n  const fetchProfile = useCallback(async () => {\n    try {\n      const response = await apiClient.get('/user/profile');\n      if (response.success && response.data) {\n        setAuthState({\n          user: response.data.user,\n          isAuthenticated: true,\n          isLoading: false,\n          error: null\n        });\n      } else {\n        throw new Error(response.message || 'Ошибка получения профиля');\n      }\n    } catch (error) {\n      setAuthState({\n        user: null,\n        isAuthenticated: false,\n        isLoading: false,\n        error: error.message || 'Ошибка авторизации'\n      });\n    }\n  }, []);\n\n  // Выход из системы\n  const logout = useCallback(() => {\n    localStorage.removeItem('auth_token');\n    apiClient.removeAuthToken();\n    setAuthState({\n      user: null,\n      isAuthenticated: false,\n      isLoading: false,\n      error: null\n    });\n  }, []);\n\n  // Инициализация при загрузке\n  useEffect(() => {\n    const token = localStorage.getItem('auth_token');\n    if (token) {\n      apiClient.setAuthToken(token);\n      fetchProfile();\n    } else {\n      setAuthState(prev => ({\n        ...prev,\n        isLoading: false\n      }));\n    }\n  }, [fetchProfile]);\n  return {\n    ...authState,\n    register,\n    logout,\n    refetch: fetchProfile\n  };\n};\n_s(useAuth, \"BL6s464tld0WFFmFp5WVIwl9kes=\");","map":{"version":3,"names":["useState","useEffect","useCallback","apiClient","useAuth","_s","authState","setAuthState","user","isAuthenticated","isLoading","error","register","telegramData","prev","response","post","success","data","localStorage","setItem","token","setAuthToken","fetchProfile","message","get","Error","logout","removeItem","removeAuthToken","getItem","refetch"],"sources":["C:/Users/admnp/Desktop/Loya/frontends/client/src/hooks/useAuth.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\nimport { apiClient } from '../services/apiClient';\nimport { User, TelegramData, ApiResponse } from '../types';\n\ninterface AuthState {\n  user: User | null;\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  error: string | null;\n}\n\nexport const useAuth = () => {\n  const [authState, setAuthState] = useState<AuthState>({\n    user: null,\n    isAuthenticated: false,\n    isLoading: true,\n    error: null\n  });\n\n  // Регистрация пользователя\n  const register = useCallback(async (telegramData: TelegramData) => {\n    try {\n      setAuthState(prev => ({ ...prev, isLoading: true, error: null }));\n      \n      const response = await apiClient.post<{ userId: string; token: string }>(\n        '/user/register',\n        telegramData\n      );\n\n      if (response.success && response.data) {\n        // Сохраняем токен\n        localStorage.setItem('auth_token', response.data.token);\n        apiClient.setAuthToken(response.data.token);\n        \n        // Получаем профиль пользователя\n        await fetchProfile();\n      }\n    } catch (error: any) {\n      setAuthState(prev => ({ \n        ...prev, \n        isLoading: false, \n        error: error.message || 'Ошибка регистрации' \n      }));\n    }\n  }, []);\n\n  // Получение профиля пользователя\n  const fetchProfile = useCallback(async () => {\n    try {\n      const response = await apiClient.get<{ user: User; pointsInfo: any }>('/user/profile');\n      \n      if (response.success && response.data) {\n        setAuthState({\n          user: response.data.user,\n          isAuthenticated: true,\n          isLoading: false,\n          error: null\n        });\n      } else {\n        throw new Error(response.message || 'Ошибка получения профиля');\n      }\n    } catch (error: any) {\n      setAuthState({\n        user: null,\n        isAuthenticated: false,\n        isLoading: false,\n        error: error.message || 'Ошибка авторизации'\n      });\n    }\n  }, []);\n\n  // Выход из системы\n  const logout = useCallback(() => {\n    localStorage.removeItem('auth_token');\n    apiClient.removeAuthToken();\n    setAuthState({\n      user: null,\n      isAuthenticated: false,\n      isLoading: false,\n      error: null\n    });\n  }, []);\n\n  // Инициализация при загрузке\n  useEffect(() => {\n    const token = localStorage.getItem('auth_token');\n    if (token) {\n      apiClient.setAuthToken(token);\n      fetchProfile();\n    } else {\n      setAuthState(prev => ({ ...prev, isLoading: false }));\n    }\n  }, [fetchProfile]);\n\n  return {\n    ...authState,\n    register,\n    logout,\n    refetch: fetchProfile\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}