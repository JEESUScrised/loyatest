{"ast":null,"code":"import _objectSpread from\"C:/Users/admnp/Desktop/Loya/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect,useCallback}from'react';import{apiClient}from'../services/apiClient';export const useAuth=()=>{const[authState,setAuthState]=useState({user:null,isAuthenticated:false,isLoading:true,error:null});// Регистрация пользователя\nconst register=useCallback(async telegramData=>{try{setAuthState(prev=>_objectSpread(_objectSpread({},prev),{},{isLoading:true,error:null}));const response=await apiClient.post('/user/register',telegramData);if(response.success&&response.data){// Сохраняем токен\nlocalStorage.setItem('auth_token',response.data.token);apiClient.setAuthToken(response.data.token);// Получаем профиль пользователя\nawait fetchProfile();}}catch(error){setAuthState(prev=>_objectSpread(_objectSpread({},prev),{},{isLoading:false,error:error.message||'Ошибка регистрации'}));}},[]);// Получение профиля пользователя\nconst fetchProfile=useCallback(async()=>{try{const response=await apiClient.get('/user/profile');if(response.success&&response.data){setAuthState({user:response.data.user,isAuthenticated:true,isLoading:false,error:null});}else{throw new Error(response.message||'Ошибка получения профиля');}}catch(error){setAuthState({user:null,isAuthenticated:false,isLoading:false,error:error.message||'Ошибка авторизации'});}},[]);// Выход из системы\nconst logout=useCallback(()=>{localStorage.removeItem('auth_token');apiClient.removeAuthToken();setAuthState({user:null,isAuthenticated:false,isLoading:false,error:null});},[]);// Инициализация при загрузке\nuseEffect(()=>{const token=localStorage.getItem('auth_token');if(token){apiClient.setAuthToken(token);fetchProfile();}else{setAuthState(prev=>_objectSpread(_objectSpread({},prev),{},{isLoading:false}));}},[fetchProfile]);return _objectSpread(_objectSpread({},authState),{},{register,logout,refetch:fetchProfile});};","map":{"version":3,"names":["useState","useEffect","useCallback","apiClient","useAuth","authState","setAuthState","user","isAuthenticated","isLoading","error","register","telegramData","prev","_objectSpread","response","post","success","data","localStorage","setItem","token","setAuthToken","fetchProfile","message","get","Error","logout","removeItem","removeAuthToken","getItem","refetch"],"sources":["C:/Users/admnp/Desktop/Loya/frontends/client/src/hooks/useAuth.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\nimport { apiClient } from '../services/apiClient';\nimport { User, TelegramData, ApiResponse } from '../types';\n\ninterface AuthState {\n  user: User | null;\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  error: string | null;\n}\n\nexport const useAuth = () => {\n  const [authState, setAuthState] = useState<AuthState>({\n    user: null,\n    isAuthenticated: false,\n    isLoading: true,\n    error: null\n  });\n\n  // Регистрация пользователя\n  const register = useCallback(async (telegramData: TelegramData) => {\n    try {\n      setAuthState(prev => ({ ...prev, isLoading: true, error: null }));\n      \n      const response = await apiClient.post<{ userId: string; token: string }>(\n        '/user/register',\n        telegramData\n      );\n\n      if (response.success && response.data) {\n        // Сохраняем токен\n        localStorage.setItem('auth_token', response.data.token);\n        apiClient.setAuthToken(response.data.token);\n        \n        // Получаем профиль пользователя\n        await fetchProfile();\n      }\n    } catch (error: any) {\n      setAuthState(prev => ({ \n        ...prev, \n        isLoading: false, \n        error: error.message || 'Ошибка регистрации' \n      }));\n    }\n  }, []);\n\n  // Получение профиля пользователя\n  const fetchProfile = useCallback(async () => {\n    try {\n      const response = await apiClient.get<{ user: User; pointsInfo: any }>('/user/profile');\n      \n      if (response.success && response.data) {\n        setAuthState({\n          user: response.data.user,\n          isAuthenticated: true,\n          isLoading: false,\n          error: null\n        });\n      } else {\n        throw new Error(response.message || 'Ошибка получения профиля');\n      }\n    } catch (error: any) {\n      setAuthState({\n        user: null,\n        isAuthenticated: false,\n        isLoading: false,\n        error: error.message || 'Ошибка авторизации'\n      });\n    }\n  }, []);\n\n  // Выход из системы\n  const logout = useCallback(() => {\n    localStorage.removeItem('auth_token');\n    apiClient.removeAuthToken();\n    setAuthState({\n      user: null,\n      isAuthenticated: false,\n      isLoading: false,\n      error: null\n    });\n  }, []);\n\n  // Инициализация при загрузке\n  useEffect(() => {\n    const token = localStorage.getItem('auth_token');\n    if (token) {\n      apiClient.setAuthToken(token);\n      fetchProfile();\n    } else {\n      setAuthState(prev => ({ ...prev, isLoading: false }));\n    }\n  }, [fetchProfile]);\n\n  return {\n    ...authState,\n    register,\n    logout,\n    refetch: fetchProfile\n  };\n};\n"],"mappings":"gHAAA,OAASA,QAAQ,CAAEC,SAAS,CAAEC,WAAW,KAAQ,OAAO,CACxD,OAASC,SAAS,KAAQ,uBAAuB,CAUjD,MAAO,MAAM,CAAAC,OAAO,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAACC,SAAS,CAAEC,YAAY,CAAC,CAAGN,QAAQ,CAAY,CACpDO,IAAI,CAAE,IAAI,CACVC,eAAe,CAAE,KAAK,CACtBC,SAAS,CAAE,IAAI,CACfC,KAAK,CAAE,IACT,CAAC,CAAC,CAEF;AACA,KAAM,CAAAC,QAAQ,CAAGT,WAAW,CAAC,KAAO,CAAAU,YAA0B,EAAK,CACjE,GAAI,CACFN,YAAY,CAACO,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAEJ,SAAS,CAAE,IAAI,CAAEC,KAAK,CAAE,IAAI,EAAG,CAAC,CAEjE,KAAM,CAAAK,QAAQ,CAAG,KAAM,CAAAZ,SAAS,CAACa,IAAI,CACnC,gBAAgB,CAChBJ,YACF,CAAC,CAED,GAAIG,QAAQ,CAACE,OAAO,EAAIF,QAAQ,CAACG,IAAI,CAAE,CACrC;AACAC,YAAY,CAACC,OAAO,CAAC,YAAY,CAAEL,QAAQ,CAACG,IAAI,CAACG,KAAK,CAAC,CACvDlB,SAAS,CAACmB,YAAY,CAACP,QAAQ,CAACG,IAAI,CAACG,KAAK,CAAC,CAE3C;AACA,KAAM,CAAAE,YAAY,CAAC,CAAC,CACtB,CACF,CAAE,MAAOb,KAAU,CAAE,CACnBJ,YAAY,CAACO,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACZD,IAAI,MACPJ,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAEA,KAAK,CAACc,OAAO,EAAI,oBAAoB,EAC5C,CAAC,CACL,CACF,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAD,YAAY,CAAGrB,WAAW,CAAC,SAAY,CAC3C,GAAI,CACF,KAAM,CAAAa,QAAQ,CAAG,KAAM,CAAAZ,SAAS,CAACsB,GAAG,CAAkC,eAAe,CAAC,CAEtF,GAAIV,QAAQ,CAACE,OAAO,EAAIF,QAAQ,CAACG,IAAI,CAAE,CACrCZ,YAAY,CAAC,CACXC,IAAI,CAAEQ,QAAQ,CAACG,IAAI,CAACX,IAAI,CACxBC,eAAe,CAAE,IAAI,CACrBC,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,IACT,CAAC,CAAC,CACJ,CAAC,IAAM,CACL,KAAM,IAAI,CAAAgB,KAAK,CAACX,QAAQ,CAACS,OAAO,EAAI,0BAA0B,CAAC,CACjE,CACF,CAAE,MAAOd,KAAU,CAAE,CACnBJ,YAAY,CAAC,CACXC,IAAI,CAAE,IAAI,CACVC,eAAe,CAAE,KAAK,CACtBC,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAEA,KAAK,CAACc,OAAO,EAAI,oBAC1B,CAAC,CAAC,CACJ,CACF,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAG,MAAM,CAAGzB,WAAW,CAAC,IAAM,CAC/BiB,YAAY,CAACS,UAAU,CAAC,YAAY,CAAC,CACrCzB,SAAS,CAAC0B,eAAe,CAAC,CAAC,CAC3BvB,YAAY,CAAC,CACXC,IAAI,CAAE,IAAI,CACVC,eAAe,CAAE,KAAK,CACtBC,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,IACT,CAAC,CAAC,CACJ,CAAC,CAAE,EAAE,CAAC,CAEN;AACAT,SAAS,CAAC,IAAM,CACd,KAAM,CAAAoB,KAAK,CAAGF,YAAY,CAACW,OAAO,CAAC,YAAY,CAAC,CAChD,GAAIT,KAAK,CAAE,CACTlB,SAAS,CAACmB,YAAY,CAACD,KAAK,CAAC,CAC7BE,YAAY,CAAC,CAAC,CAChB,CAAC,IAAM,CACLjB,YAAY,CAACO,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAEJ,SAAS,CAAE,KAAK,EAAG,CAAC,CACvD,CACF,CAAC,CAAE,CAACc,YAAY,CAAC,CAAC,CAElB,OAAAT,aAAA,CAAAA,aAAA,IACKT,SAAS,MACZM,QAAQ,CACRgB,MAAM,CACNI,OAAO,CAAER,YAAY,GAEzB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}