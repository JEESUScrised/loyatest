{"ast":null,"code":"import { apiClient } from './apiClient';\nclass AuthService {\n  // Проверка авторизации\n  isAuthenticated() {\n    return !!apiClient.getAuthToken();\n  }\n\n  // Авторизация кассира\n  async loginCashier(credentials) {\n    try {\n      const response = await apiClient.post('/auth/cashier', {\n        username: credentials.username,\n        password: credentials.password\n      });\n      if (response.success && response.data) {\n        // Сохраняем токен\n        apiClient.setAuthToken(response.data.access_token);\n        return {\n          success: true,\n          user: response.data.user,\n          access_token: response.data.access_token,\n          refresh_token: response.data.refresh_token\n        };\n      }\n      return {\n        success: false,\n        message: response.message || 'Ошибка авторизации'\n      };\n    } catch (error) {\n      return {\n        success: false,\n        message: error.message || 'Ошибка авторизации'\n      };\n    }\n  }\n\n  // Получение профиля пользователя\n  async getProfile() {\n    try {\n      const response = await apiClient.get('/cashier/profile');\n      if (response.success && response.data) {\n        return response.data;\n      }\n      return null;\n    } catch (error) {\n      console.error('Ошибка получения профиля:', error);\n      return null;\n    }\n  }\n\n  // Обновление токена\n  async refreshToken() {\n    try {\n      const response = await apiClient.post('/auth/refresh');\n      if (response.success && response.data) {\n        apiClient.setAuthToken(response.data.access_token);\n      } else {\n        throw new Error('Ошибка обновления токена');\n      }\n    } catch (error) {\n      this.logout();\n      throw error;\n    }\n  }\n\n  // Выход из системы\n  logout() {\n    apiClient.removeAuthToken();\n  }\n}\nexport const authService = new AuthService();","map":{"version":3,"names":["apiClient","AuthService","isAuthenticated","getAuthToken","loginCashier","credentials","response","post","username","password","success","data","setAuthToken","access_token","user","refresh_token","message","error","getProfile","get","console","refreshToken","Error","logout","removeAuthToken","authService"],"sources":["C:/Users/admnp/Desktop/Loya/frontends/cashier/src/services/authService.ts"],"sourcesContent":["import { apiClient } from './apiClient';\r\nimport { UserRole } from '../types';\r\n\r\nexport interface AuthUser {\r\n  id: string;\r\n  username?: string;\r\n  email?: string;\r\n  first_name?: string;\r\n  last_name?: string;\r\n  phone?: string;\r\n  role: UserRole;\r\n  is_active: boolean;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n  last_login?: string;\r\n  venue_id?: string;\r\n  venue_code?: string;\r\n  venue_name?: string;\r\n}\r\n\r\nexport interface LoginResponse {\r\n  success: boolean;\r\n  message?: string;\r\n  user?: AuthUser;\r\n  access_token?: string;\r\n  refresh_token?: string;\r\n}\r\n\r\nclass AuthService {\r\n  // Проверка авторизации\r\n  public isAuthenticated(): boolean {\r\n    return !!apiClient.getAuthToken();\r\n  }\r\n\r\n  // Авторизация кассира\r\n  public async loginCashier(credentials: { username: string; password: string }): Promise<LoginResponse> {\r\n    try {\r\n      const response = await apiClient.post<{\r\n        user: AuthUser;\r\n        access_token: string;\r\n        refresh_token: string;\r\n      }>('/auth/cashier', {\r\n        username: credentials.username,\r\n        password: credentials.password,\r\n      });\r\n\r\n      if (response.success && response.data) {\r\n        // Сохраняем токен\r\n        apiClient.setAuthToken(response.data.access_token);\r\n        \r\n        return {\r\n          success: true,\r\n          user: response.data.user,\r\n          access_token: response.data.access_token,\r\n          refresh_token: response.data.refresh_token,\r\n        };\r\n      }\r\n\r\n      return {\r\n        success: false,\r\n        message: response.message || 'Ошибка авторизации',\r\n      };\r\n    } catch (error: any) {\r\n      return {\r\n        success: false,\r\n        message: error.message || 'Ошибка авторизации',\r\n      };\r\n    }\r\n  }\r\n\r\n  // Получение профиля пользователя\r\n  public async getProfile(): Promise<AuthUser | null> {\r\n    try {\r\n      const response = await apiClient.get<AuthUser>('/cashier/profile');\r\n      \r\n      if (response.success && response.data) {\r\n        return response.data;\r\n      }\r\n\r\n      return null;\r\n    } catch (error: any) {\r\n      console.error('Ошибка получения профиля:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Обновление токена\r\n  public async refreshToken(): Promise<void> {\r\n    try {\r\n      const response = await apiClient.post<{ access_token: string }>('/auth/refresh');\r\n      \r\n      if (response.success && response.data) {\r\n        apiClient.setAuthToken(response.data.access_token);\r\n      } else {\r\n        throw new Error('Ошибка обновления токена');\r\n      }\r\n    } catch (error: any) {\r\n      this.logout();\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Выход из системы\r\n  public logout(): void {\r\n    apiClient.removeAuthToken();\r\n  }\r\n}\r\n\r\nexport const authService = new AuthService();\r\n\r\n"],"mappings":"AAAA,SAASA,SAAS,QAAQ,aAAa;AA4BvC,MAAMC,WAAW,CAAC;EAChB;EACOC,eAAeA,CAAA,EAAY;IAChC,OAAO,CAAC,CAACF,SAAS,CAACG,YAAY,CAAC,CAAC;EACnC;;EAEA;EACA,MAAaC,YAAYA,CAACC,WAAmD,EAA0B;IACrG,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAMN,SAAS,CAACO,IAAI,CAIlC,eAAe,EAAE;QAClBC,QAAQ,EAAEH,WAAW,CAACG,QAAQ;QAC9BC,QAAQ,EAAEJ,WAAW,CAACI;MACxB,CAAC,CAAC;MAEF,IAAIH,QAAQ,CAACI,OAAO,IAAIJ,QAAQ,CAACK,IAAI,EAAE;QACrC;QACAX,SAAS,CAACY,YAAY,CAACN,QAAQ,CAACK,IAAI,CAACE,YAAY,CAAC;QAElD,OAAO;UACLH,OAAO,EAAE,IAAI;UACbI,IAAI,EAAER,QAAQ,CAACK,IAAI,CAACG,IAAI;UACxBD,YAAY,EAAEP,QAAQ,CAACK,IAAI,CAACE,YAAY;UACxCE,aAAa,EAAET,QAAQ,CAACK,IAAI,CAACI;QAC/B,CAAC;MACH;MAEA,OAAO;QACLL,OAAO,EAAE,KAAK;QACdM,OAAO,EAAEV,QAAQ,CAACU,OAAO,IAAI;MAC/B,CAAC;IACH,CAAC,CAAC,OAAOC,KAAU,EAAE;MACnB,OAAO;QACLP,OAAO,EAAE,KAAK;QACdM,OAAO,EAAEC,KAAK,CAACD,OAAO,IAAI;MAC5B,CAAC;IACH;EACF;;EAEA;EACA,MAAaE,UAAUA,CAAA,EAA6B;IAClD,IAAI;MACF,MAAMZ,QAAQ,GAAG,MAAMN,SAAS,CAACmB,GAAG,CAAW,kBAAkB,CAAC;MAElE,IAAIb,QAAQ,CAACI,OAAO,IAAIJ,QAAQ,CAACK,IAAI,EAAE;QACrC,OAAOL,QAAQ,CAACK,IAAI;MACtB;MAEA,OAAO,IAAI;IACb,CAAC,CAAC,OAAOM,KAAU,EAAE;MACnBG,OAAO,CAACH,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACjD,OAAO,IAAI;IACb;EACF;;EAEA;EACA,MAAaI,YAAYA,CAAA,EAAkB;IACzC,IAAI;MACF,MAAMf,QAAQ,GAAG,MAAMN,SAAS,CAACO,IAAI,CAA2B,eAAe,CAAC;MAEhF,IAAID,QAAQ,CAACI,OAAO,IAAIJ,QAAQ,CAACK,IAAI,EAAE;QACrCX,SAAS,CAACY,YAAY,CAACN,QAAQ,CAACK,IAAI,CAACE,YAAY,CAAC;MACpD,CAAC,MAAM;QACL,MAAM,IAAIS,KAAK,CAAC,0BAA0B,CAAC;MAC7C;IACF,CAAC,CAAC,OAAOL,KAAU,EAAE;MACnB,IAAI,CAACM,MAAM,CAAC,CAAC;MACb,MAAMN,KAAK;IACb;EACF;;EAEA;EACOM,MAAMA,CAAA,EAAS;IACpBvB,SAAS,CAACwB,eAAe,CAAC,CAAC;EAC7B;AACF;AAEA,OAAO,MAAMC,WAAW,GAAG,IAAIxB,WAAW,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}