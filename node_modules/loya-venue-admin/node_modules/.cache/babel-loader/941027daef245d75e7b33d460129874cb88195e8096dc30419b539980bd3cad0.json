{"ast":null,"code":"// Сервис для работы с платежами через Юкассу\n\nclass PaymentService {\n  constructor() {\n    this.backendUrl = 'http://localhost:5000/api/admin';\n  }\n  // Создание платежа через реальный API Юкассы\n  async createPayment(paymentData) {\n    const idempotenceKey = this.generateIdempotenceKey();\n    const requestBody = {\n      amount: {\n        value: paymentData.amount.toFixed(2),\n        currency: paymentData.currency\n      },\n      capture: true,\n      confirmation: {\n        type: 'redirect',\n        return_url: paymentData.returnUrl\n      },\n      description: paymentData.description,\n      metadata: paymentData.metadata || {}\n    };\n    try {\n      var _result$confirmation;\n      const response = await fetch(`${this.baseUrl}/payments`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Basic ${btoa(`${this.shopId}:${this.apiKey}`)}`,\n          'Idempotence-Key': idempotenceKey,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(requestBody)\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const result = await response.json();\n      console.log('Создан платеж через Юкассу:', {\n        paymentId: result.id,\n        status: result.status,\n        amount: result.amount,\n        confirmationUrl: (_result$confirmation = result.confirmation) === null || _result$confirmation === void 0 ? void 0 : _result$confirmation.confirmation_url\n      });\n      return {\n        id: result.id,\n        status: result.status,\n        confirmation: {\n          type: result.confirmation.type,\n          confirmation_url: result.confirmation.confirmation_url\n        }\n      };\n    } catch (error) {\n      console.error('Ошибка создания платежа:', error);\n      throw new Error('Не удалось создать платеж. Пожалуйста, попробуйте еще раз.');\n    }\n  }\n\n  // Получение статуса платежа через реальный API Юкассы\n  async getPaymentStatus(paymentId) {\n    try {\n      const response = await fetch(`${this.baseUrl}/payments/${paymentId}`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Basic ${btoa(`${this.shopId}:${this.apiKey}`)}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const result = await response.json();\n      console.log('Получен статус платежа:', {\n        paymentId: result.id,\n        status: result.status,\n        amount: result.amount,\n        paid: result.paid\n      });\n      return result;\n    } catch (error) {\n      console.error('Ошибка получения статуса платежа:', error);\n      throw new Error('Не удалось получить статус платежа.');\n    }\n  }\n\n  // Генерация уникального ключа для идемпотентности\n  generateIdempotenceKey() {\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\n  }\n\n  // Создание платежа для продления подписки\n  async createSubscriptionPayment(months = 1) {\n    const amount = months * 1000; // 1000 рублей за месяц\n\n    return this.createPayment({\n      amount,\n      currency: 'RUB',\n      description: `Продление подписки Loya на ${months} ${months === 1 ? 'месяц' : 'месяца'}`,\n      returnUrl: `${window.location.origin}/payment/success`,\n      metadata: {\n        type: 'subscription_renewal',\n        months: months.toString(),\n        venue_code: 'VKU'\n      }\n    });\n  }\n}\nexport const paymentService = new PaymentService();","map":{"version":3,"names":["PaymentService","constructor","backendUrl","createPayment","paymentData","idempotenceKey","generateIdempotenceKey","requestBody","amount","value","toFixed","currency","capture","confirmation","type","return_url","returnUrl","description","metadata","_result$confirmation","response","fetch","baseUrl","method","headers","btoa","shopId","apiKey","body","JSON","stringify","ok","Error","status","result","json","console","log","paymentId","id","confirmationUrl","confirmation_url","error","getPaymentStatus","paid","Date","now","toString","Math","random","substr","createSubscriptionPayment","months","window","location","origin","venue_code","paymentService"],"sources":["C:/Users/user/Desktop/loyaverse/Loya/frontends/venue-admin/src/services/paymentService.ts"],"sourcesContent":["// Сервис для работы с платежами через Юкассу\r\nexport interface PaymentData {\r\n  amount: number;\r\n  currency: string;\r\n  description: string;\r\n  returnUrl: string;\r\n  metadata?: Record<string, string>;\r\n}\r\n\r\nexport interface PaymentResponse {\r\n  id: string;\r\n  status: string;\r\n  confirmation: {\r\n    type: string;\r\n    confirmation_url: string;\r\n  };\r\n}\r\n\r\nclass PaymentService {\r\n  private readonly backendUrl = 'http://localhost:5000/api/admin';\r\n\r\n  // Создание платежа через реальный API Юкассы\r\n  async createPayment(paymentData: PaymentData): Promise<PaymentResponse> {\r\n    const idempotenceKey = this.generateIdempotenceKey();\r\n    \r\n    const requestBody = {\r\n      amount: {\r\n        value: paymentData.amount.toFixed(2),\r\n        currency: paymentData.currency\r\n      },\r\n      capture: true,\r\n      confirmation: {\r\n        type: 'redirect',\r\n        return_url: paymentData.returnUrl\r\n      },\r\n      description: paymentData.description,\r\n      metadata: paymentData.metadata || {}\r\n    };\r\n\r\n    try {\r\n      const response = await fetch(`${this.baseUrl}/payments`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Basic ${btoa(`${this.shopId}:${this.apiKey}`)}`,\r\n          'Idempotence-Key': idempotenceKey,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(requestBody)\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json();\r\n      \r\n      console.log('Создан платеж через Юкассу:', {\r\n        paymentId: result.id,\r\n        status: result.status,\r\n        amount: result.amount,\r\n        confirmationUrl: result.confirmation?.confirmation_url\r\n      });\r\n\r\n      return {\r\n        id: result.id,\r\n        status: result.status,\r\n        confirmation: {\r\n          type: result.confirmation.type,\r\n          confirmation_url: result.confirmation.confirmation_url\r\n        }\r\n      };\r\n    } catch (error) {\r\n      console.error('Ошибка создания платежа:', error);\r\n      throw new Error('Не удалось создать платеж. Пожалуйста, попробуйте еще раз.');\r\n    }\r\n  }\r\n\r\n  // Получение статуса платежа через реальный API Юкассы\r\n  async getPaymentStatus(paymentId: string): Promise<any> {\r\n    try {\r\n      const response = await fetch(`${this.baseUrl}/payments/${paymentId}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Basic ${btoa(`${this.shopId}:${this.apiKey}`)}`,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json();\r\n      \r\n      console.log('Получен статус платежа:', {\r\n        paymentId: result.id,\r\n        status: result.status,\r\n        amount: result.amount,\r\n        paid: result.paid\r\n      });\r\n\r\n      return result;\r\n    } catch (error) {\r\n      console.error('Ошибка получения статуса платежа:', error);\r\n      throw new Error('Не удалось получить статус платежа.');\r\n    }\r\n  }\r\n\r\n  // Генерация уникального ключа для идемпотентности\r\n  private generateIdempotenceKey(): string {\r\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\r\n  }\r\n\r\n  // Создание платежа для продления подписки\r\n  async createSubscriptionPayment(months: number = 1): Promise<PaymentResponse> {\r\n    const amount = months * 1000; // 1000 рублей за месяц\r\n    \r\n    return this.createPayment({\r\n      amount,\r\n      currency: 'RUB',\r\n      description: `Продление подписки Loya на ${months} ${months === 1 ? 'месяц' : 'месяца'}`,\r\n      returnUrl: `${window.location.origin}/payment/success`,\r\n      metadata: {\r\n        type: 'subscription_renewal',\r\n        months: months.toString(),\r\n        venue_code: 'VKU'\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport const paymentService = new PaymentService();\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}