{"ast":null,"code":"// Сервис для работы с платежами через Юкассу\n\nclass PaymentService {\n  constructor() {\n    this.apiKey = 'test__UW59qNHWI_40gv3XfJTubp_5zQtFKft2UOLRSy8oxI';\n    this.shopId = '1184633';\n    this.baseUrl = 'https://api.yookassa.ru/v3';\n  }\n  // Создание платежа\n  async createPayment(paymentData) {\n    const requestBody = {\n      amount: {\n        value: paymentData.amount.toFixed(2),\n        currency: paymentData.currency\n      },\n      confirmation: {\n        type: 'redirect',\n        return_url: paymentData.returnUrl\n      },\n      description: paymentData.description,\n      metadata: paymentData.metadata || {}\n    };\n    try {\n      const response = await fetch(`${this.baseUrl}/payments`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Basic ${btoa(`${this.shopId}:${this.apiKey}`)}`,\n          'Content-Type': 'application/json',\n          'Idempotence-Key': this.generateIdempotenceKey()\n        },\n        body: JSON.stringify(requestBody)\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const result = await response.json();\n      return result;\n    } catch (error) {\n      console.error('Ошибка создания платежа:', error);\n      throw error;\n    }\n  }\n\n  // Получение статуса платежа\n  async getPaymentStatus(paymentId) {\n    try {\n      const response = await fetch(`${this.baseUrl}/payments/${paymentId}`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Basic ${btoa(`${this.shopId}:${this.apiKey}`)}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('Ошибка получения статуса платежа:', error);\n      throw error;\n    }\n  }\n\n  // Генерация уникального ключа для идемпотентности\n  generateIdempotenceKey() {\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\n  }\n\n  // Создание платежа для продления подписки\n  async createSubscriptionPayment(months = 1) {\n    const amount = months * 1000; // 1000 рублей за месяц\n\n    return this.createPayment({\n      amount,\n      currency: 'RUB',\n      description: `Продление подписки Loya на ${months} ${months === 1 ? 'месяц' : 'месяца'}`,\n      returnUrl: `${window.location.origin}/payment/success`,\n      metadata: {\n        type: 'subscription_renewal',\n        months: months.toString(),\n        venue_code: 'VKU'\n      }\n    });\n  }\n}\nexport const paymentService = new PaymentService();","map":{"version":3,"names":["PaymentService","constructor","apiKey","shopId","baseUrl","createPayment","paymentData","requestBody","amount","value","toFixed","currency","confirmation","type","return_url","returnUrl","description","metadata","response","fetch","method","headers","btoa","generateIdempotenceKey","body","JSON","stringify","ok","Error","status","result","json","error","console","getPaymentStatus","paymentId","Date","now","toString","Math","random","substr","createSubscriptionPayment","months","window","location","origin","venue_code","paymentService"],"sources":["C:/Users/user/Desktop/loyaverse/Loya/frontends/venue-admin/src/services/paymentService.ts"],"sourcesContent":["// Сервис для работы с платежами через Юкассу\r\nexport interface PaymentData {\r\n  amount: number;\r\n  currency: string;\r\n  description: string;\r\n  returnUrl: string;\r\n  metadata?: Record<string, string>;\r\n}\r\n\r\nexport interface PaymentResponse {\r\n  id: string;\r\n  status: string;\r\n  confirmation: {\r\n    type: string;\r\n    confirmation_url: string;\r\n  };\r\n}\r\n\r\nclass PaymentService {\r\n  private readonly apiKey = 'test__UW59qNHWI_40gv3XfJTubp_5zQtFKft2UOLRSy8oxI';\r\n  private readonly shopId = '1184633';\r\n  private readonly baseUrl = 'https://api.yookassa.ru/v3';\r\n\r\n  // Создание платежа\r\n  async createPayment(paymentData: PaymentData): Promise<PaymentResponse> {\r\n    const requestBody = {\r\n      amount: {\r\n        value: paymentData.amount.toFixed(2),\r\n        currency: paymentData.currency\r\n      },\r\n      confirmation: {\r\n        type: 'redirect',\r\n        return_url: paymentData.returnUrl\r\n      },\r\n      description: paymentData.description,\r\n      metadata: paymentData.metadata || {}\r\n    };\r\n\r\n    try {\r\n      const response = await fetch(`${this.baseUrl}/payments`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Basic ${btoa(`${this.shopId}:${this.apiKey}`)}`,\r\n          'Content-Type': 'application/json',\r\n          'Idempotence-Key': this.generateIdempotenceKey()\r\n        },\r\n        body: JSON.stringify(requestBody)\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json();\r\n      return result;\r\n    } catch (error) {\r\n      console.error('Ошибка создания платежа:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Получение статуса платежа\r\n  async getPaymentStatus(paymentId: string): Promise<any> {\r\n    try {\r\n      const response = await fetch(`${this.baseUrl}/payments/${paymentId}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Basic ${btoa(`${this.shopId}:${this.apiKey}`)}`,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Ошибка получения статуса платежа:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Генерация уникального ключа для идемпотентности\r\n  private generateIdempotenceKey(): string {\r\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\r\n  }\r\n\r\n  // Создание платежа для продления подписки\r\n  async createSubscriptionPayment(months: number = 1): Promise<PaymentResponse> {\r\n    const amount = months * 1000; // 1000 рублей за месяц\r\n    \r\n    return this.createPayment({\r\n      amount,\r\n      currency: 'RUB',\r\n      description: `Продление подписки Loya на ${months} ${months === 1 ? 'месяц' : 'месяца'}`,\r\n      returnUrl: `${window.location.origin}/payment/success`,\r\n      metadata: {\r\n        type: 'subscription_renewal',\r\n        months: months.toString(),\r\n        venue_code: 'VKU'\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport const paymentService = new PaymentService();\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}