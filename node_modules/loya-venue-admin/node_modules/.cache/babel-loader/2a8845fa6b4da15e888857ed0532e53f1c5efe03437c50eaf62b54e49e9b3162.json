{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.authService = exports.AuthService = void 0;\nconst axios_1 = __importDefault(require(\"axios\"));\nconst constants_1 = require(\"../utils/constants\");\n// Сервис для работы с авторизацией\nclass AuthService {\n  constructor() {\n    this.token = null;\n    // Загружаем токен из localStorage при инициализации\n    this.token = this.getStoredToken();\n    this.setupAxiosInterceptors();\n  }\n  static getInstance() {\n    if (!AuthService.instance) {\n      AuthService.instance = new AuthService();\n    }\n    return AuthService.instance;\n  }\n  // Получение токена из localStorage\n  getStoredToken() {\n    if (typeof window !== 'undefined') {\n      return localStorage.getItem('auth_token');\n    }\n    return null;\n  }\n  // Сохранение токена в localStorage\n  setStoredToken(token) {\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('auth_token', token);\n    }\n  }\n  // Удаление токена из localStorage\n  removeStoredToken() {\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem('auth_token');\n    }\n  }\n  // Настройка axios interceptors для автоматического добавления токена\n  setupAxiosInterceptors() {\n    // Request interceptor - добавляем токен к каждому запросу\n    axios_1.default.interceptors.request.use(config => {\n      if (this.token) {\n        config.headers.Authorization = `Bearer ${this.token}`;\n      }\n      return config;\n    }, error => {\n      return Promise.reject(error);\n    });\n    // Response interceptor - обрабатываем ошибки авторизации\n    axios_1.default.interceptors.response.use(response => response, error => {\n      if (error.response?.status === 401) {\n        // Токен недействителен, очищаем его\n        this.logout();\n      }\n      return Promise.reject(error);\n    });\n  }\n  // Регистрация/авторизация через Telegram\n  async loginWithTelegram(credentials) {\n    try {\n      const response = await axios_1.default.post(`${constants_1.API_BASE_URL}/api/user/register`, credentials);\n      if (response.data.success && response.data.token) {\n        this.token = response.data.token;\n        this.setStoredToken(response.data.token);\n        return response.data;\n      }\n      throw new Error(response.data.message || 'Ошибка авторизации');\n    } catch (error) {\n      throw new Error(error.response?.data?.message || 'Ошибка подключения к серверу');\n    }\n  }\n  // Получение профиля пользователя\n  async getProfile() {\n    try {\n      const response = await axios_1.default.get(`${constants_1.API_BASE_URL}/api/user/profile`);\n      if (response.data.success) {\n        return response.data.data;\n      }\n      throw new Error(response.data.message || 'Ошибка получения профиля');\n    } catch (error) {\n      throw new Error(error.response?.data?.message || 'Ошибка подключения к серверу');\n    }\n  }\n  // Обновление токена\n  async refreshToken() {\n    try {\n      const response = await axios_1.default.post(`${constants_1.API_BASE_URL}/api/auth/refresh`);\n      if (response.data.success && response.data.token) {\n        this.token = response.data.token;\n        this.setStoredToken(response.data.token);\n      }\n    } catch (error) {\n      // Если не удалось обновить токен, выходим\n      this.logout();\n      throw error;\n    }\n  }\n  // Выход из системы\n  logout() {\n    this.token = null;\n    this.removeStoredToken();\n  }\n  // Проверка валидности токена\n  isTokenValid() {\n    if (!this.token) return false;\n    try {\n      const payload = this.decodeToken(this.token);\n      const now = Math.floor(Date.now() / 1000);\n      return payload.exp > now;\n    } catch {\n      return false;\n    }\n  }\n  // Декодирование JWT токена\n  decodeToken(token) {\n    if (!token) {\n      throw new Error('Token is required');\n    }\n    const base64Url = token.split('.')[1];\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n    const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));\n    return JSON.parse(jsonPayload);\n  }\n  // Получение текущего токена\n  getToken() {\n    return this.token;\n  }\n  // Проверка авторизации\n  isAuthenticated() {\n    return this.isTokenValid();\n  }\n}\nexports.AuthService = AuthService;\n// Экспортируем singleton instance\nexports.authService = AuthService.getInstance();","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","authService","AuthService","axios_1","require","constants_1","constructor","token","getStoredToken","setupAxiosInterceptors","getInstance","instance","window","localStorage","getItem","setStoredToken","setItem","removeStoredToken","removeItem","default","interceptors","request","use","config","headers","Authorization","error","Promise","reject","response","status","logout","loginWithTelegram","credentials","post","API_BASE_URL","data","success","Error","message","getProfile","get","refreshToken","isTokenValid","payload","decodeToken","now","Math","floor","Date","exp","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","getToken","isAuthenticated"],"sources":["/home/admnp@delta.sys/Desktops/loyaverse/Loya/shared/dist/services/auth.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.authService = exports.AuthService = void 0;\nconst axios_1 = __importDefault(require(\"axios\"));\nconst constants_1 = require(\"../utils/constants\");\n// Сервис для работы с авторизацией\nclass AuthService {\n    constructor() {\n        this.token = null;\n        // Загружаем токен из localStorage при инициализации\n        this.token = this.getStoredToken();\n        this.setupAxiosInterceptors();\n    }\n    static getInstance() {\n        if (!AuthService.instance) {\n            AuthService.instance = new AuthService();\n        }\n        return AuthService.instance;\n    }\n    // Получение токена из localStorage\n    getStoredToken() {\n        if (typeof window !== 'undefined') {\n            return localStorage.getItem('auth_token');\n        }\n        return null;\n    }\n    // Сохранение токена в localStorage\n    setStoredToken(token) {\n        if (typeof window !== 'undefined') {\n            localStorage.setItem('auth_token', token);\n        }\n    }\n    // Удаление токена из localStorage\n    removeStoredToken() {\n        if (typeof window !== 'undefined') {\n            localStorage.removeItem('auth_token');\n        }\n    }\n    // Настройка axios interceptors для автоматического добавления токена\n    setupAxiosInterceptors() {\n        // Request interceptor - добавляем токен к каждому запросу\n        axios_1.default.interceptors.request.use((config) => {\n            if (this.token) {\n                config.headers.Authorization = `Bearer ${this.token}`;\n            }\n            return config;\n        }, (error) => {\n            return Promise.reject(error);\n        });\n        // Response interceptor - обрабатываем ошибки авторизации\n        axios_1.default.interceptors.response.use((response) => response, (error) => {\n            if (error.response?.status === 401) {\n                // Токен недействителен, очищаем его\n                this.logout();\n            }\n            return Promise.reject(error);\n        });\n    }\n    // Регистрация/авторизация через Telegram\n    async loginWithTelegram(credentials) {\n        try {\n            const response = await axios_1.default.post(`${constants_1.API_BASE_URL}/api/user/register`, credentials);\n            if (response.data.success && response.data.token) {\n                this.token = response.data.token;\n                this.setStoredToken(response.data.token);\n                return response.data;\n            }\n            throw new Error(response.data.message || 'Ошибка авторизации');\n        }\n        catch (error) {\n            throw new Error(error.response?.data?.message || 'Ошибка подключения к серверу');\n        }\n    }\n    // Получение профиля пользователя\n    async getProfile() {\n        try {\n            const response = await axios_1.default.get(`${constants_1.API_BASE_URL}/api/user/profile`);\n            if (response.data.success) {\n                return response.data.data;\n            }\n            throw new Error(response.data.message || 'Ошибка получения профиля');\n        }\n        catch (error) {\n            throw new Error(error.response?.data?.message || 'Ошибка подключения к серверу');\n        }\n    }\n    // Обновление токена\n    async refreshToken() {\n        try {\n            const response = await axios_1.default.post(`${constants_1.API_BASE_URL}/api/auth/refresh`);\n            if (response.data.success && response.data.token) {\n                this.token = response.data.token;\n                this.setStoredToken(response.data.token);\n            }\n        }\n        catch (error) {\n            // Если не удалось обновить токен, выходим\n            this.logout();\n            throw error;\n        }\n    }\n    // Выход из системы\n    logout() {\n        this.token = null;\n        this.removeStoredToken();\n    }\n    // Проверка валидности токена\n    isTokenValid() {\n        if (!this.token)\n            return false;\n        try {\n            const payload = this.decodeToken(this.token);\n            const now = Math.floor(Date.now() / 1000);\n            return payload.exp > now;\n        }\n        catch {\n            return false;\n        }\n    }\n    // Декодирование JWT токена\n    decodeToken(token) {\n        if (!token) {\n            throw new Error('Token is required');\n        }\n        const base64Url = token.split('.')[1];\n        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n        const jsonPayload = decodeURIComponent(atob(base64)\n            .split('')\n            .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\n            .join(''));\n        return JSON.parse(jsonPayload);\n    }\n    // Получение текущего токена\n    getToken() {\n        return this.token;\n    }\n    // Проверка авторизации\n    isAuthenticated() {\n        return this.isTokenValid();\n    }\n}\nexports.AuthService = AuthService;\n// Экспортируем singleton instance\nexports.authService = AuthService.getInstance();\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}