{"ast":null,"code":"import axios from 'axios';\nimport { API_BASE_URL } from '../utils/constants';\n// Сервис для работы с авторизацией\nexport class AuthService {\n  constructor() {\n    this.token = null;\n    // Загружаем токен из localStorage при инициализации\n    this.token = this.getStoredToken();\n    this.setupAxiosInterceptors();\n  }\n  static getInstance() {\n    if (!AuthService.instance) {\n      AuthService.instance = new AuthService();\n    }\n    return AuthService.instance;\n  }\n  // Получение токена из localStorage\n  getStoredToken() {\n    if (typeof window !== 'undefined') {\n      return localStorage.getItem('auth_token');\n    }\n    return null;\n  }\n  // Сохранение токена в localStorage\n  setStoredToken(token) {\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('auth_token', token);\n    }\n  }\n  // Удаление токена из localStorage\n  removeStoredToken() {\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem('auth_token');\n    }\n  }\n  // Настройка axios interceptors для автоматического добавления токена\n  setupAxiosInterceptors() {\n    // Request interceptor - добавляем токен к каждому запросу\n    axios.interceptors.request.use(config => {\n      if (this.token) {\n        config.headers.Authorization = `Bearer ${this.token}`;\n      }\n      return config;\n    }, error => {\n      return Promise.reject(error);\n    });\n    // Response interceptor - обрабатываем ошибки авторизации\n    axios.interceptors.response.use(response => response, error => {\n      var _a;\n      if (((_a = error.response) === null || _a === void 0 ? void 0 : _a.status) === 401) {\n        // Токен недействителен, очищаем его\n        this.logout();\n      }\n      return Promise.reject(error);\n    });\n  }\n  // Регистрация/авторизация через Telegram\n  async loginWithTelegram(credentials) {\n    var _a, _b;\n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/user/register`, credentials);\n      if (response.data.success && response.data.token) {\n        this.token = response.data.token;\n        this.setStoredToken(response.data.token);\n        return response.data;\n      }\n      throw new Error(response.data.message || 'Ошибка авторизации');\n    } catch (error) {\n      throw new Error(((_b = (_a = error.response) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b.message) || 'Ошибка подключения к серверу');\n    }\n  }\n  // Получение профиля пользователя\n  async getProfile() {\n    var _a, _b;\n    try {\n      const response = await axios.get(`${API_BASE_URL}/api/user/profile`);\n      if (response.data.success) {\n        return response.data.data;\n      }\n      throw new Error(response.data.message || 'Ошибка получения профиля');\n    } catch (error) {\n      throw new Error(((_b = (_a = error.response) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b.message) || 'Ошибка подключения к серверу');\n    }\n  }\n  // Обновление токена\n  async refreshToken() {\n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/auth/refresh`);\n      if (response.data.success && response.data.token) {\n        this.token = response.data.token;\n        this.setStoredToken(response.data.token);\n      }\n    } catch (error) {\n      // Если не удалось обновить токен, выходим\n      this.logout();\n      throw error;\n    }\n  }\n  // Выход из системы\n  logout() {\n    this.token = null;\n    this.removeStoredToken();\n  }\n  // Проверка валидности токена\n  isTokenValid() {\n    if (!this.token) return false;\n    try {\n      const payload = this.decodeToken(this.token);\n      const now = Math.floor(Date.now() / 1000);\n      return payload.exp > now;\n    } catch (_a) {\n      return false;\n    }\n  }\n  // Декодирование JWT токена\n  decodeToken(token) {\n    if (!token) {\n      throw new Error('Token is required');\n    }\n    const base64Url = token.split('.')[1];\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n    const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));\n    return JSON.parse(jsonPayload);\n  }\n  // Получение текущего токена\n  getToken() {\n    return this.token;\n  }\n  // Проверка авторизации\n  isAuthenticated() {\n    return this.isTokenValid();\n  }\n}\n// Экспортируем singleton instance\nexport const authService = AuthService.getInstance();","map":{"version":3,"names":["axios","API_BASE_URL","AuthService","constructor","token","getStoredToken","setupAxiosInterceptors","getInstance","instance","window","localStorage","getItem","setStoredToken","setItem","removeStoredToken","removeItem","interceptors","request","use","config","headers","Authorization","error","Promise","reject","response","_a","status","logout","loginWithTelegram","credentials","_b","post","data","success","Error","message","getProfile","get","refreshToken","isTokenValid","payload","decodeToken","now","Math","floor","Date","exp","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","getToken","isAuthenticated","authService"],"sources":["C:/Users/user/Desktop/loyaverse/Loya/shared/dist/services/auth.js"],"sourcesContent":["import axios from 'axios';\r\nimport { API_BASE_URL } from '../utils/constants';\r\n// Сервис для работы с авторизацией\r\nexport class AuthService {\r\n    constructor() {\r\n        this.token = null;\r\n        // Загружаем токен из localStorage при инициализации\r\n        this.token = this.getStoredToken();\r\n        this.setupAxiosInterceptors();\r\n    }\r\n    static getInstance() {\r\n        if (!AuthService.instance) {\r\n            AuthService.instance = new AuthService();\r\n        }\r\n        return AuthService.instance;\r\n    }\r\n    // Получение токена из localStorage\r\n    getStoredToken() {\r\n        if (typeof window !== 'undefined') {\r\n            return localStorage.getItem('auth_token');\r\n        }\r\n        return null;\r\n    }\r\n    // Сохранение токена в localStorage\r\n    setStoredToken(token) {\r\n        if (typeof window !== 'undefined') {\r\n            localStorage.setItem('auth_token', token);\r\n        }\r\n    }\r\n    // Удаление токена из localStorage\r\n    removeStoredToken() {\r\n        if (typeof window !== 'undefined') {\r\n            localStorage.removeItem('auth_token');\r\n        }\r\n    }\r\n    // Настройка axios interceptors для автоматического добавления токена\r\n    setupAxiosInterceptors() {\r\n        // Request interceptor - добавляем токен к каждому запросу\r\n        axios.interceptors.request.use((config) => {\r\n            if (this.token) {\r\n                config.headers.Authorization = `Bearer ${this.token}`;\r\n            }\r\n            return config;\r\n        }, (error) => {\r\n            return Promise.reject(error);\r\n        });\r\n        // Response interceptor - обрабатываем ошибки авторизации\r\n        axios.interceptors.response.use((response) => response, (error) => {\r\n            var _a;\r\n            if (((_a = error.response) === null || _a === void 0 ? void 0 : _a.status) === 401) {\r\n                // Токен недействителен, очищаем его\r\n                this.logout();\r\n            }\r\n            return Promise.reject(error);\r\n        });\r\n    }\r\n    // Регистрация/авторизация через Telegram\r\n    async loginWithTelegram(credentials) {\r\n        var _a, _b;\r\n        try {\r\n            const response = await axios.post(`${API_BASE_URL}/api/user/register`, credentials);\r\n            if (response.data.success && response.data.token) {\r\n                this.token = response.data.token;\r\n                this.setStoredToken(response.data.token);\r\n                return response.data;\r\n            }\r\n            throw new Error(response.data.message || 'Ошибка авторизации');\r\n        }\r\n        catch (error) {\r\n            throw new Error(((_b = (_a = error.response) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b.message) || 'Ошибка подключения к серверу');\r\n        }\r\n    }\r\n    // Получение профиля пользователя\r\n    async getProfile() {\r\n        var _a, _b;\r\n        try {\r\n            const response = await axios.get(`${API_BASE_URL}/api/user/profile`);\r\n            if (response.data.success) {\r\n                return response.data.data;\r\n            }\r\n            throw new Error(response.data.message || 'Ошибка получения профиля');\r\n        }\r\n        catch (error) {\r\n            throw new Error(((_b = (_a = error.response) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b.message) || 'Ошибка подключения к серверу');\r\n        }\r\n    }\r\n    // Обновление токена\r\n    async refreshToken() {\r\n        try {\r\n            const response = await axios.post(`${API_BASE_URL}/api/auth/refresh`);\r\n            if (response.data.success && response.data.token) {\r\n                this.token = response.data.token;\r\n                this.setStoredToken(response.data.token);\r\n            }\r\n        }\r\n        catch (error) {\r\n            // Если не удалось обновить токен, выходим\r\n            this.logout();\r\n            throw error;\r\n        }\r\n    }\r\n    // Выход из системы\r\n    logout() {\r\n        this.token = null;\r\n        this.removeStoredToken();\r\n    }\r\n    // Проверка валидности токена\r\n    isTokenValid() {\r\n        if (!this.token)\r\n            return false;\r\n        try {\r\n            const payload = this.decodeToken(this.token);\r\n            const now = Math.floor(Date.now() / 1000);\r\n            return payload.exp > now;\r\n        }\r\n        catch (_a) {\r\n            return false;\r\n        }\r\n    }\r\n    // Декодирование JWT токена\r\n    decodeToken(token) {\r\n        if (!token) {\r\n            throw new Error('Token is required');\r\n        }\r\n        const base64Url = token.split('.')[1];\r\n        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n        const jsonPayload = decodeURIComponent(atob(base64)\r\n            .split('')\r\n            .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\r\n            .join(''));\r\n        return JSON.parse(jsonPayload);\r\n    }\r\n    // Получение текущего токена\r\n    getToken() {\r\n        return this.token;\r\n    }\r\n    // Проверка авторизации\r\n    isAuthenticated() {\r\n        return this.isTokenValid();\r\n    }\r\n}\r\n// Экспортируем singleton instance\r\nexport const authService = AuthService.getInstance();\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}