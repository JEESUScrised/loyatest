{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useCallback } from 'react';\nimport { apiClient } from '../services/apiClient';\nexport const useCashier = () => {\n  _s();\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [currentCode, setCurrentCode] = useState(null);\n  const [venueCode, setVenueCode] = useState('VKU'); // По умолчанию\n\n  // Генерация кода покупки\n  const generateCode = useCallback(async purchaseAmount => {\n    try {\n      setIsLoading(true);\n      setError(null);\n\n      // Моковая генерация кода для демонстрации\n      const mockCode = Math.random().toString(36).substring(2, 8).toUpperCase();\n      const mockResponse = {\n        success: true,\n        data: {\n          code: mockCode,\n          purchaseAmount,\n          venueCode,\n          expiresAt: new Date(Date.now() + 5 * 60 * 1000).toISOString() // 5 минут\n        }\n      };\n      if (mockResponse.success && mockResponse.data) {\n        setCurrentCode(mockResponse.data.code);\n        return mockResponse.data;\n      } else {\n        throw new Error('Ошибка генерации кода');\n      }\n    } catch (error) {\n      const errorMessage = error.message || 'Ошибка генерации кода';\n      setError(errorMessage);\n      throw new Error(errorMessage);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [venueCode]);\n\n  // Получение истории кодов\n  const getCodeHistory = useCallback(async params => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const queryParams = new URLSearchParams();\n      if (params !== null && params !== void 0 && params.page) queryParams.append('page', params.page.toString());\n      if (params !== null && params !== void 0 && params.limit) queryParams.append('limit', params.limit.toString());\n      if (params !== null && params !== void 0 && params.startDate) queryParams.append('startDate', params.startDate);\n      if (params !== null && params !== void 0 && params.endDate) queryParams.append('endDate', params.endDate);\n      const response = await apiClient.get(`/cashier/codes?${queryParams.toString()}`);\n      if (response.success && response.data) {\n        return response.data;\n      } else {\n        throw new Error(response.message || 'Ошибка получения истории');\n      }\n    } catch (error) {\n      const errorMessage = error.message || 'Ошибка получения истории';\n      setError(errorMessage);\n      throw new Error(errorMessage);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Получение статистики продаж\n  const getSalesStats = useCallback(async params => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const queryParams = new URLSearchParams();\n      if (params !== null && params !== void 0 && params.period) queryParams.append('period', params.period);\n      if (params !== null && params !== void 0 && params.startDate) queryParams.append('startDate', params.startDate);\n      if (params !== null && params !== void 0 && params.endDate) queryParams.append('endDate', params.endDate);\n      const response = await apiClient.get(`/cashier/stats?${queryParams.toString()}`);\n      if (response.success && response.data) {\n        return response.data;\n      } else {\n        throw new Error(response.message || 'Ошибка получения статистики');\n      }\n    } catch (error) {\n      const errorMessage = error.message || 'Ошибка получения статистики';\n      setError(errorMessage);\n      throw new Error(errorMessage);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Авторизация кассира\n  const authenticateCashier = useCallback(async credentials => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const response = await apiClient.post('/cashier/auth', credentials);\n      if (response.success && response.data) {\n        setVenueCode(credentials.venueCode);\n        return response.data;\n      } else {\n        throw new Error(response.message || 'Ошибка авторизации');\n      }\n    } catch (error) {\n      const errorMessage = error.message || 'Ошибка авторизации';\n      setError(errorMessage);\n      throw new Error(errorMessage);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n  return {\n    isLoading,\n    error,\n    currentCode,\n    venueCode,\n    setVenueCode,\n    generateCode,\n    getCodeHistory,\n    getSalesStats,\n    authenticateCashier,\n    clearError: () => setError(null),\n    clearCurrentCode: () => setCurrentCode(null)\n  };\n};\n_s(useCashier, \"DTealgfwLqbyVz0sETXrAV+zwF8=\");","map":{"version":3,"names":["useState","useCallback","apiClient","useCashier","_s","isLoading","setIsLoading","error","setError","currentCode","setCurrentCode","venueCode","setVenueCode","generateCode","purchaseAmount","mockCode","Math","random","toString","substring","toUpperCase","mockResponse","success","data","code","expiresAt","Date","now","toISOString","Error","errorMessage","message","getCodeHistory","params","queryParams","URLSearchParams","page","append","limit","startDate","endDate","response","get","getSalesStats","period","authenticateCashier","credentials","post","clearError","clearCurrentCode"],"sources":["C:/Users/admnp/Desktop/Loya/frontends/cashier/src/hooks/useCashier.ts"],"sourcesContent":["import { useState, useCallback } from 'react';\nimport { apiClient } from '../services/apiClient';\nimport { GenerateCodeResponse } from '../types';\n\nexport const useCashier = () => {\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [currentCode, setCurrentCode] = useState<string | null>(null);\n  const [venueCode, setVenueCode] = useState<string>('VKU'); // По умолчанию\n\n  // Генерация кода покупки\n  const generateCode = useCallback(async (purchaseAmount: number) => {\n    try {\n      setIsLoading(true);\n      setError(null);\n\n      // Моковая генерация кода для демонстрации\n      const mockCode = Math.random().toString(36).substring(2, 8).toUpperCase();\n      const mockResponse = {\n        success: true,\n        data: {\n          code: mockCode,\n          purchaseAmount,\n          venueCode,\n          expiresAt: new Date(Date.now() + 5 * 60 * 1000).toISOString() // 5 минут\n        }\n      };\n\n      if (mockResponse.success && mockResponse.data) {\n        setCurrentCode(mockResponse.data.code);\n        return mockResponse.data;\n      } else {\n        throw new Error('Ошибка генерации кода');\n      }\n    } catch (error: any) {\n      const errorMessage = error.message || 'Ошибка генерации кода';\n      setError(errorMessage);\n      throw new Error(errorMessage);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [venueCode]);\n\n  // Получение истории кодов\n  const getCodeHistory = useCallback(async (params?: {\n    page?: number;\n    limit?: number;\n    startDate?: string;\n    endDate?: string;\n  }) => {\n    try {\n      setIsLoading(true);\n      setError(null);\n\n      const queryParams = new URLSearchParams();\n      if (params?.page) queryParams.append('page', params.page.toString());\n      if (params?.limit) queryParams.append('limit', params.limit.toString());\n      if (params?.startDate) queryParams.append('startDate', params.startDate);\n      if (params?.endDate) queryParams.append('endDate', params.endDate);\n\n      const response = await apiClient.get(`/cashier/codes?${queryParams.toString()}`);\n\n      if (response.success && response.data) {\n        return response.data;\n      } else {\n        throw new Error(response.message || 'Ошибка получения истории');\n      }\n    } catch (error: any) {\n      const errorMessage = error.message || 'Ошибка получения истории';\n      setError(errorMessage);\n      throw new Error(errorMessage);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Получение статистики продаж\n  const getSalesStats = useCallback(async (params?: {\n    period?: 'day' | 'week' | 'month';\n    startDate?: string;\n    endDate?: string;\n  }) => {\n    try {\n      setIsLoading(true);\n      setError(null);\n\n      const queryParams = new URLSearchParams();\n      if (params?.period) queryParams.append('period', params.period);\n      if (params?.startDate) queryParams.append('startDate', params.startDate);\n      if (params?.endDate) queryParams.append('endDate', params.endDate);\n\n      const response = await apiClient.get(`/cashier/stats?${queryParams.toString()}`);\n\n      if (response.success && response.data) {\n        return response.data;\n      } else {\n        throw new Error(response.message || 'Ошибка получения статистики');\n      }\n    } catch (error: any) {\n      const errorMessage = error.message || 'Ошибка получения статистики';\n      setError(errorMessage);\n      throw new Error(errorMessage);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Авторизация кассира\n  const authenticateCashier = useCallback(async (credentials: {\n    venueCode: string;\n    cashierCode: string;\n  }) => {\n    try {\n      setIsLoading(true);\n      setError(null);\n\n      const response = await apiClient.post('/cashier/auth', credentials);\n\n      if (response.success && response.data) {\n        setVenueCode(credentials.venueCode);\n        return response.data;\n      } else {\n        throw new Error(response.message || 'Ошибка авторизации');\n      }\n    } catch (error: any) {\n      const errorMessage = error.message || 'Ошибка авторизации';\n      setError(errorMessage);\n      throw new Error(errorMessage);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  return {\n    isLoading,\n    error,\n    currentCode,\n    venueCode,\n    setVenueCode,\n    generateCode,\n    getCodeHistory,\n    getSalesStats,\n    authenticateCashier,\n    clearError: () => setError(null),\n    clearCurrentCode: () => setCurrentCode(null)\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}