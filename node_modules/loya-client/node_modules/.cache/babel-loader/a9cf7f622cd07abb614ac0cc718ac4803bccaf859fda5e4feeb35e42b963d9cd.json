{"ast":null,"code":"// Сервис для загрузки данных заведений из JSON файлов\n// Кэш для загруженных данных\nconst venueCache=new Map();/**\r\n * Загружает данные заведения по ID из JSON файла\r\n */export async function loadVenueData(venueId){// Проверяем кэш\nif(venueCache.has(venueId)){return venueCache.get(venueId);}try{const response=await fetch(\"/data/venues/\".concat(venueId,\".json\"));if(!response.ok){console.error(\"Failed to load venue \".concat(venueId,\": \").concat(response.statusText));return null;}const data=await response.json();venueCache.set(venueId,data);return data;}catch(error){console.error(\"Error loading venue \".concat(venueId,\":\"),error);return null;}}/**\r\n * Загружает данные нескольких заведений\r\n */export async function loadVenuesData(venueIds){const promises=venueIds.map(id=>loadVenueData(id));const results=await Promise.all(promises);return results.filter(venue=>venue!==null);}/**\r\n * Загружает все доступные заведения (если есть индексный файл)\r\n */export async function loadAllVenues(){// Пока загружаем известные ID\n// В будущем можно создать index.json с списком всех заведений\nconst knownIds=[1,2,3,4,5,6,7,8,9,10];return loadVenuesData(knownIds);}/**\r\n * Проверяет, находится ли текущее время в периоде удвоенных баллов\r\n */export function isDoublePointsTime(venue){const now=new Date();const currentDay=now.toLocaleDateString('ru-RU',{weekday:'long'}).toLowerCase();const currentTime=now.toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'});const doubleHours=venue.doublePointsHours.find(hours=>hours.day===currentDay);if(!doubleHours){return false;}const startTime=doubleHours.start;const endTime=doubleHours.end;return currentTime>=startTime&&currentTime<=endTime;}/**\r\n * Получает следующий период удвоенных баллов\r\n */export function getNextDoublePointsTime(venue){const now=new Date();const days=['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];const currentDayIndex=now.getDay();// Проверяем оставшиеся дни недели\nfor(let i=0;i<7;i++){const dayIndex=(currentDayIndex+i)%7;const day=days[dayIndex];const doubleHours=venue.doublePointsHours.find(h=>h.day===day);if(doubleHours){if(i===0){const currentTime=now.toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'});if(currentTime<doubleHours.end){return{day:getDayName(day),time:\"\".concat(doubleHours.start,\" - \").concat(doubleHours.end)};}}else{return{day:getDayName(day),time:\"\".concat(doubleHours.start,\" - \").concat(doubleHours.end)};}}}return null;}function getDayName(day){const dayNames={monday:'Понедельник',tuesday:'Вторник',wednesday:'Среда',thursday:'Четверг',friday:'Пятница',saturday:'Суббота',sunday:'Воскресенье'};return dayNames[day]||day;}","map":{"version":3,"names":["venueCache","Map","loadVenueData","venueId","has","get","response","fetch","concat","ok","console","error","statusText","data","json","set","loadVenuesData","venueIds","promises","map","id","results","Promise","all","filter","venue","loadAllVenues","knownIds","isDoublePointsTime","now","Date","currentDay","toLocaleDateString","weekday","toLowerCase","currentTime","toLocaleTimeString","hour","minute","doubleHours","doublePointsHours","find","hours","day","startTime","start","endTime","end","getNextDoublePointsTime","days","currentDayIndex","getDay","i","dayIndex","h","getDayName","time","dayNames","monday","tuesday","wednesday","thursday","friday","saturday","sunday"],"sources":["C:/Users/admnp/Desktop/Loya/frontends/client/src/services/venueDataService.ts"],"sourcesContent":["// Сервис для загрузки данных заведений из JSON файлов\r\n\r\nexport interface MenuItem {\r\n  id: number;\r\n  name: string;\r\n  description: string;\r\n  category: string;\r\n  price: number;\r\n  pointsCost: number;\r\n  pointsReward: number;\r\n  isAvailable: boolean;\r\n  isPopular: boolean;\r\n  image?: string;\r\n}\r\n\r\nexport interface DoublePointsHour {\r\n  day: 'monday' | 'tuesday' | 'wednesday' | 'thursday' | 'friday' | 'saturday' | 'sunday';\r\n  start: string;\r\n  end: string;\r\n}\r\n\r\nexport interface VenueData {\r\n  id: number;\r\n  venueCode: string;\r\n  name: string;\r\n  description: string;\r\n  address: string;\r\n  logo: string;\r\n  category: string;\r\n  rating: number;\r\n  workingHours: string;\r\n  isOpen: boolean;\r\n  pointsPerPurchase: number;\r\n  pointsType: 'general' | 'personal';\r\n  doublePointsHours: DoublePointsHour[];\r\n  menu: MenuItem[];\r\n}\r\n\r\n// Кэш для загруженных данных\r\nconst venueCache: Map<number, VenueData> = new Map();\r\n\r\n/**\r\n * Загружает данные заведения по ID из JSON файла\r\n */\r\nexport async function loadVenueData(venueId: number): Promise<VenueData | null> {\r\n  // Проверяем кэш\r\n  if (venueCache.has(venueId)) {\r\n    return venueCache.get(venueId)!;\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(`/data/venues/${venueId}.json`);\r\n    if (!response.ok) {\r\n      console.error(`Failed to load venue ${venueId}: ${response.statusText}`);\r\n      return null;\r\n    }\r\n\r\n    const data: VenueData = await response.json();\r\n    venueCache.set(venueId, data);\r\n    return data;\r\n  } catch (error) {\r\n    console.error(`Error loading venue ${venueId}:`, error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Загружает данные нескольких заведений\r\n */\r\nexport async function loadVenuesData(venueIds: number[]): Promise<VenueData[]> {\r\n  const promises = venueIds.map(id => loadVenueData(id));\r\n  const results = await Promise.all(promises);\r\n  return results.filter((venue): venue is VenueData => venue !== null);\r\n}\r\n\r\n/**\r\n * Загружает все доступные заведения (если есть индексный файл)\r\n */\r\nexport async function loadAllVenues(): Promise<VenueData[]> {\r\n  // Пока загружаем известные ID\r\n  // В будущем можно создать index.json с списком всех заведений\r\n  const knownIds = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\r\n  return loadVenuesData(knownIds);\r\n}\r\n\r\n/**\r\n * Проверяет, находится ли текущее время в периоде удвоенных баллов\r\n */\r\nexport function isDoublePointsTime(venue: VenueData): boolean {\r\n  const now = new Date();\r\n  const currentDay = now.toLocaleDateString('ru-RU', { weekday: 'long' }).toLowerCase();\r\n  const currentTime = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });\r\n\r\n  const doubleHours = venue.doublePointsHours.find(\r\n    hours => hours.day === currentDay\r\n  );\r\n\r\n  if (!doubleHours) {\r\n    return false;\r\n  }\r\n\r\n  const startTime = doubleHours.start;\r\n  const endTime = doubleHours.end;\r\n\r\n  return currentTime >= startTime && currentTime <= endTime;\r\n}\r\n\r\n/**\r\n * Получает следующий период удвоенных баллов\r\n */\r\nexport function getNextDoublePointsTime(venue: VenueData): { day: string; time: string } | null {\r\n  const now = new Date();\r\n  const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];\r\n  const currentDayIndex = now.getDay();\r\n\r\n  // Проверяем оставшиеся дни недели\r\n  for (let i = 0; i < 7; i++) {\r\n    const dayIndex = (currentDayIndex + i) % 7;\r\n    const day = days[dayIndex];\r\n    \r\n    const doubleHours = venue.doublePointsHours.find(h => h.day === day);\r\n    if (doubleHours) {\r\n      if (i === 0) {\r\n        const currentTime = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });\r\n        if (currentTime < doubleHours.end) {\r\n          return {\r\n            day: getDayName(day),\r\n            time: `${doubleHours.start} - ${doubleHours.end}`\r\n          };\r\n        }\r\n      } else {\r\n        return {\r\n          day: getDayName(day),\r\n          time: `${doubleHours.start} - ${doubleHours.end}`\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction getDayName(day: string): string {\r\n  const dayNames: { [key: string]: string } = {\r\n    monday: 'Понедельник',\r\n    tuesday: 'Вторник',\r\n    wednesday: 'Среда',\r\n    thursday: 'Четверг',\r\n    friday: 'Пятница',\r\n    saturday: 'Суббота',\r\n    sunday: 'Воскресенье'\r\n  };\r\n  return dayNames[day] || day;\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}