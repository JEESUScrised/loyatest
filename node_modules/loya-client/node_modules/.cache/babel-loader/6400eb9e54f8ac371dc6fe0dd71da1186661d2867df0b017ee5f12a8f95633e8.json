{"ast":null,"code":"// Сервис для загрузки данных заведений из JSON файлов\n\n// Кэш для загруженных данных\nconst venueCache = new Map();\n\n/**\r\n * Загружает данные заведения по ID из JSON файла\r\n */\nexport async function loadVenueData(venueId) {\n  // Проверяем кэш\n  if (venueCache.has(venueId)) {\n    return venueCache.get(venueId);\n  }\n  try {\n    const response = await fetch(`/data/venues/${venueId}.json`);\n    if (!response.ok) {\n      console.error(`Failed to load venue ${venueId}: ${response.statusText}`);\n      return null;\n    }\n    const data = await response.json();\n    venueCache.set(venueId, data);\n    return data;\n  } catch (error) {\n    console.error(`Error loading venue ${venueId}:`, error);\n    return null;\n  }\n}\n\n/**\r\n * Загружает данные нескольких заведений\r\n */\nexport async function loadVenuesData(venueIds) {\n  const promises = venueIds.map(id => loadVenueData(id));\n  const results = await Promise.all(promises);\n  return results.filter(venue => venue !== null);\n}\n\n/**\r\n * Загружает все доступные заведения (если есть индексный файл)\r\n */\nexport async function loadAllVenues() {\n  // Пока загружаем известные ID\n  // В будущем можно создать index.json с списком всех заведений\n  const knownIds = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\n  return loadVenuesData(knownIds);\n}\n\n/**\r\n * Проверяет, находится ли текущее время в периоде удвоенных баллов\r\n */\nexport function isDoublePointsTime(venue) {\n  const now = new Date();\n  const currentDay = now.toLocaleDateString('ru-RU', {\n    weekday: 'long'\n  }).toLowerCase();\n  const currentTime = now.toLocaleTimeString('ru-RU', {\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n  const doubleHours = venue.doublePointsHours.find(hours => hours.day === currentDay);\n  if (!doubleHours) {\n    return false;\n  }\n  const startTime = doubleHours.start;\n  const endTime = doubleHours.end;\n  return currentTime >= startTime && currentTime <= endTime;\n}\n\n/**\r\n * Получает следующий период удвоенных баллов\r\n */\nexport function getNextDoublePointsTime(venue) {\n  const now = new Date();\n  const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];\n  const currentDayIndex = now.getDay();\n\n  // Проверяем оставшиеся дни недели\n  for (let i = 0; i < 7; i++) {\n    const dayIndex = (currentDayIndex + i) % 7;\n    const day = days[dayIndex];\n    const doubleHours = venue.doublePointsHours.find(h => h.day === day);\n    if (doubleHours) {\n      if (i === 0) {\n        const currentTime = now.toLocaleTimeString('ru-RU', {\n          hour: '2-digit',\n          minute: '2-digit'\n        });\n        if (currentTime < doubleHours.end) {\n          return {\n            day: getDayName(day),\n            time: `${doubleHours.start} - ${doubleHours.end}`\n          };\n        }\n      } else {\n        return {\n          day: getDayName(day),\n          time: `${doubleHours.start} - ${doubleHours.end}`\n        };\n      }\n    }\n  }\n  return null;\n}\nfunction getDayName(day) {\n  const dayNames = {\n    monday: 'Понедельник',\n    tuesday: 'Вторник',\n    wednesday: 'Среда',\n    thursday: 'Четверг',\n    friday: 'Пятница',\n    saturday: 'Суббота',\n    sunday: 'Воскресенье'\n  };\n  return dayNames[day] || day;\n}","map":{"version":3,"names":["venueCache","Map","loadVenueData","venueId","has","get","response","fetch","ok","console","error","statusText","data","json","set","loadVenuesData","venueIds","promises","map","id","results","Promise","all","filter","venue","loadAllVenues","knownIds","isDoublePointsTime","now","Date","currentDay","toLocaleDateString","weekday","toLowerCase","currentTime","toLocaleTimeString","hour","minute","doubleHours","doublePointsHours","find","hours","day","startTime","start","endTime","end","getNextDoublePointsTime","days","currentDayIndex","getDay","i","dayIndex","h","getDayName","time","dayNames","monday","tuesday","wednesday","thursday","friday","saturday","sunday"],"sources":["C:/Users/admnp/Desktop/Loya/frontends/client/src/services/venueDataService.ts"],"sourcesContent":["// Сервис для загрузки данных заведений из JSON файлов\r\n\r\nexport interface MenuItem {\r\n  id: number;\r\n  name: string;\r\n  description: string;\r\n  category: string;\r\n  price: number;\r\n  pointsCost: number;\r\n  pointsReward: number;\r\n  isAvailable: boolean;\r\n  isPopular: boolean;\r\n  image?: string;\r\n}\r\n\r\nexport interface DoublePointsHour {\r\n  day: 'monday' | 'tuesday' | 'wednesday' | 'thursday' | 'friday' | 'saturday' | 'sunday';\r\n  start: string;\r\n  end: string;\r\n}\r\n\r\nexport interface VenueData {\r\n  id: number;\r\n  venueCode: string;\r\n  name: string;\r\n  description: string;\r\n  address: string;\r\n  logo: string;\r\n  category: string;\r\n  rating: number;\r\n  workingHours: string;\r\n  isOpen: boolean;\r\n  pointsPerPurchase: number;\r\n  pointsType: 'general' | 'personal';\r\n  doublePointsHours: DoublePointsHour[];\r\n  menu: MenuItem[];\r\n}\r\n\r\n// Кэш для загруженных данных\r\nconst venueCache: Map<number, VenueData> = new Map();\r\n\r\n/**\r\n * Загружает данные заведения по ID из JSON файла\r\n */\r\nexport async function loadVenueData(venueId: number): Promise<VenueData | null> {\r\n  // Проверяем кэш\r\n  if (venueCache.has(venueId)) {\r\n    return venueCache.get(venueId)!;\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(`/data/venues/${venueId}.json`);\r\n    if (!response.ok) {\r\n      console.error(`Failed to load venue ${venueId}: ${response.statusText}`);\r\n      return null;\r\n    }\r\n\r\n    const data: VenueData = await response.json();\r\n    venueCache.set(venueId, data);\r\n    return data;\r\n  } catch (error) {\r\n    console.error(`Error loading venue ${venueId}:`, error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Загружает данные нескольких заведений\r\n */\r\nexport async function loadVenuesData(venueIds: number[]): Promise<VenueData[]> {\r\n  const promises = venueIds.map(id => loadVenueData(id));\r\n  const results = await Promise.all(promises);\r\n  return results.filter((venue): venue is VenueData => venue !== null);\r\n}\r\n\r\n/**\r\n * Загружает все доступные заведения (если есть индексный файл)\r\n */\r\nexport async function loadAllVenues(): Promise<VenueData[]> {\r\n  // Пока загружаем известные ID\r\n  // В будущем можно создать index.json с списком всех заведений\r\n  const knownIds = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\r\n  return loadVenuesData(knownIds);\r\n}\r\n\r\n/**\r\n * Проверяет, находится ли текущее время в периоде удвоенных баллов\r\n */\r\nexport function isDoublePointsTime(venue: VenueData): boolean {\r\n  const now = new Date();\r\n  const currentDay = now.toLocaleDateString('ru-RU', { weekday: 'long' }).toLowerCase();\r\n  const currentTime = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });\r\n\r\n  const doubleHours = venue.doublePointsHours.find(\r\n    hours => hours.day === currentDay\r\n  );\r\n\r\n  if (!doubleHours) {\r\n    return false;\r\n  }\r\n\r\n  const startTime = doubleHours.start;\r\n  const endTime = doubleHours.end;\r\n\r\n  return currentTime >= startTime && currentTime <= endTime;\r\n}\r\n\r\n/**\r\n * Получает следующий период удвоенных баллов\r\n */\r\nexport function getNextDoublePointsTime(venue: VenueData): { day: string; time: string } | null {\r\n  const now = new Date();\r\n  const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];\r\n  const currentDayIndex = now.getDay();\r\n\r\n  // Проверяем оставшиеся дни недели\r\n  for (let i = 0; i < 7; i++) {\r\n    const dayIndex = (currentDayIndex + i) % 7;\r\n    const day = days[dayIndex];\r\n    \r\n    const doubleHours = venue.doublePointsHours.find(h => h.day === day);\r\n    if (doubleHours) {\r\n      if (i === 0) {\r\n        const currentTime = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });\r\n        if (currentTime < doubleHours.end) {\r\n          return {\r\n            day: getDayName(day),\r\n            time: `${doubleHours.start} - ${doubleHours.end}`\r\n          };\r\n        }\r\n      } else {\r\n        return {\r\n          day: getDayName(day),\r\n          time: `${doubleHours.start} - ${doubleHours.end}`\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction getDayName(day: string): string {\r\n  const dayNames: { [key: string]: string } = {\r\n    monday: 'Понедельник',\r\n    tuesday: 'Вторник',\r\n    wednesday: 'Среда',\r\n    thursday: 'Четверг',\r\n    friday: 'Пятница',\r\n    saturday: 'Суббота',\r\n    sunday: 'Воскресенье'\r\n  };\r\n  return dayNames[day] || day;\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}