{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import{Html5Qrcode}from'html5-qrcode';import{useApp}from'../contexts/AppContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const QRScannerModal=_ref=>{let{isOpen,onClose,onScan}=_ref;const scannerRef=useRef(null);const[error,setError]=useState(null);const[isScanning,setIsScanning]=useState(false);const{hapticFeedback}=useApp();const scannerId='qr-scanner';useEffect(()=>{if(isOpen){startScanning();}else{stopScanning();}return()=>{stopScanning();};},[isOpen]);const startScanning=async()=>{try{setError(null);setIsScanning(true);// Создаем экземпляр сканера\nconst scanner=new Html5Qrcode(scannerId);scannerRef.current=scanner;// Начинаем сканирование\nawait scanner.start({facingMode:'environment'// Используем заднюю камеру\n},{fps:10,// Кадров в секунду\nqrbox:{width:250,height:250}// Размер области сканирования\n},decodedText=>{// QR-код успешно отсканирован\nhapticFeedback.notification('success');onScan(decodedText);stopScanning();onClose();},errorMessage=>{// Игнорируем ошибки сканирования (код еще не найден)\n// Ошибки выводятся только в консоль для отладки\n});}catch(err){console.error('Ошибка доступа к камере:',err);let errorMessage='Не удалось получить доступ к камере.';if(err.name==='NotAllowedError'){errorMessage='Доступ к камере запрещен. Разрешите доступ в настройках браузера.';}else if(err.name==='NotFoundError'){errorMessage='Камера не найдена на устройстве.';}else if(err.name==='NotReadableError'){errorMessage='Камера уже используется другим приложением.';}setError(errorMessage);setIsScanning(false);hapticFeedback.notification('error');}};const stopScanning=async()=>{if(scannerRef.current&&isScanning){try{await scannerRef.current.stop();await scannerRef.current.clear();}catch(err){console.error('Ошибка остановки сканера:',err);}scannerRef.current=null;}setIsScanning(false);};if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0, 0, 0, 0.9)',zIndex:10000,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',padding:'20px'},onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{style:{width:'100%',maxWidth:'400px',background:'var(--bg-primary)',borderRadius:'var(--radius-lg)',padding:'20px',position:'relative'},onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:'0 0 8px 0',color:'var(--text-primary)',fontSize:'18px',fontWeight:'600'},children:\"\\u0421\\u043A\\u0430\\u043D\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435 QR-\\u043A\\u043E\\u0434\\u0430\"}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'0',color:'var(--text-secondary)',fontSize:'14px'},children:\"\\u041D\\u0430\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u043A\\u0430\\u043C\\u0435\\u0440\\u0443 \\u043D\\u0430 QR-\\u043A\\u043E\\u0434\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{position:'relative',width:'100%',aspectRatio:'1',background:'#000',borderRadius:'var(--radius-md)',overflow:'hidden',marginBottom:'16px'},children:/*#__PURE__*/_jsx(\"div\",{id:scannerId,style:{width:'100%',height:'100%'}})}),error&&/*#__PURE__*/_jsx(\"div\",{style:{background:'rgba(239, 68, 68, 0.1)',border:'1px solid rgba(239, 68, 68, 0.3)',borderRadius:'var(--radius-md)',padding:'12px',color:'var(--error)',fontSize:'14px',marginBottom:'16px',textAlign:'center'},children:error}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'12px'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{stopScanning();onClose();},style:{flex:1,padding:'12px',background:'var(--glass-bg)',border:'1px solid var(--glass-border)',borderRadius:'var(--radius-md)',color:'var(--text-primary)',fontSize:'16px',fontWeight:'600',cursor:'pointer'},children:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{stopScanning();startScanning();},style:{flex:1,padding:'12px',background:'var(--accent-gradient)',border:'none',borderRadius:'var(--radius-md)',color:'var(--bg-primary)',fontSize:'16px',fontWeight:'600',cursor:'pointer'},children:\"\\u041F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C\"})]})]})});};export default QRScannerModal;","map":{"version":3,"names":["React","useEffect","useRef","useState","Html5Qrcode","useApp","jsx","_jsx","jsxs","_jsxs","QRScannerModal","_ref","isOpen","onClose","onScan","scannerRef","error","setError","isScanning","setIsScanning","hapticFeedback","scannerId","startScanning","stopScanning","scanner","current","start","facingMode","fps","qrbox","width","height","decodedText","notification","errorMessage","err","console","name","stop","clear","style","position","top","left","right","bottom","background","zIndex","display","flexDirection","alignItems","justifyContent","padding","onClick","children","maxWidth","borderRadius","e","stopPropagation","marginBottom","textAlign","margin","color","fontSize","fontWeight","aspectRatio","overflow","id","border","gap","flex","cursor"],"sources":["C:/Users/admnp/Desktop/Loya/frontends/client/src/components/QRScannerModal.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { Html5Qrcode } from 'html5-qrcode';\r\nimport { useApp } from '../contexts/AppContext';\r\n\r\ninterface QRScannerModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onScan: (code: string) => void;\r\n}\r\n\r\nconst QRScannerModal: React.FC<QRScannerModalProps> = ({ isOpen, onClose, onScan }) => {\r\n  const scannerRef = useRef<Html5Qrcode | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isScanning, setIsScanning] = useState(false);\r\n  const { hapticFeedback } = useApp();\r\n  const scannerId = 'qr-scanner';\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      startScanning();\r\n    } else {\r\n      stopScanning();\r\n    }\r\n\r\n    return () => {\r\n      stopScanning();\r\n    };\r\n  }, [isOpen]);\r\n\r\n  const startScanning = async () => {\r\n    try {\r\n      setError(null);\r\n      setIsScanning(true);\r\n\r\n      // Создаем экземпляр сканера\r\n      const scanner = new Html5Qrcode(scannerId);\r\n      scannerRef.current = scanner;\r\n\r\n      // Начинаем сканирование\r\n      await scanner.start(\r\n        {\r\n          facingMode: 'environment' // Используем заднюю камеру\r\n        },\r\n        {\r\n          fps: 10, // Кадров в секунду\r\n          qrbox: { width: 250, height: 250 } // Размер области сканирования\r\n        },\r\n        (decodedText) => {\r\n          // QR-код успешно отсканирован\r\n          hapticFeedback.notification('success');\r\n          onScan(decodedText);\r\n          stopScanning();\r\n          onClose();\r\n        },\r\n        (errorMessage) => {\r\n          // Игнорируем ошибки сканирования (код еще не найден)\r\n          // Ошибки выводятся только в консоль для отладки\r\n        }\r\n      );\r\n    } catch (err: any) {\r\n      console.error('Ошибка доступа к камере:', err);\r\n      \r\n      let errorMessage = 'Не удалось получить доступ к камере.';\r\n      \r\n      if (err.name === 'NotAllowedError') {\r\n        errorMessage = 'Доступ к камере запрещен. Разрешите доступ в настройках браузера.';\r\n      } else if (err.name === 'NotFoundError') {\r\n        errorMessage = 'Камера не найдена на устройстве.';\r\n      } else if (err.name === 'NotReadableError') {\r\n        errorMessage = 'Камера уже используется другим приложением.';\r\n      }\r\n      \r\n      setError(errorMessage);\r\n      setIsScanning(false);\r\n      hapticFeedback.notification('error');\r\n    }\r\n  };\r\n\r\n  const stopScanning = async () => {\r\n    if (scannerRef.current && isScanning) {\r\n      try {\r\n        await scannerRef.current.stop();\r\n        await scannerRef.current.clear();\r\n      } catch (err) {\r\n        console.error('Ошибка остановки сканера:', err);\r\n      }\r\n      scannerRef.current = null;\r\n    }\r\n    setIsScanning(false);\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        position: 'fixed',\r\n        top: 0,\r\n        left: 0,\r\n        right: 0,\r\n        bottom: 0,\r\n        background: 'rgba(0, 0, 0, 0.9)',\r\n        zIndex: 10000,\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        padding: '20px'\r\n      }}\r\n      onClick={onClose}\r\n    >\r\n      <div\r\n        style={{\r\n          width: '100%',\r\n          maxWidth: '400px',\r\n          background: 'var(--bg-primary)',\r\n          borderRadius: 'var(--radius-lg)',\r\n          padding: '20px',\r\n          position: 'relative'\r\n        }}\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <div style={{ marginBottom: '16px', textAlign: 'center' }}>\r\n          <h3 style={{\r\n            margin: '0 0 8px 0',\r\n            color: 'var(--text-primary)',\r\n            fontSize: '18px',\r\n            fontWeight: '600'\r\n          }}>\r\n            Сканирование QR-кода\r\n          </h3>\r\n          <p style={{\r\n            margin: '0',\r\n            color: 'var(--text-secondary)',\r\n            fontSize: '14px'\r\n          }}>\r\n            Наведите камеру на QR-код\r\n          </p>\r\n        </div>\r\n\r\n        <div style={{\r\n          position: 'relative',\r\n          width: '100%',\r\n          aspectRatio: '1',\r\n          background: '#000',\r\n          borderRadius: 'var(--radius-md)',\r\n          overflow: 'hidden',\r\n          marginBottom: '16px'\r\n        }}>\r\n          {/* Контейнер для сканера */}\r\n          <div id={scannerId} style={{\r\n            width: '100%',\r\n            height: '100%'\r\n          }} />\r\n        </div>\r\n\r\n        {error && (\r\n          <div style={{\r\n            background: 'rgba(239, 68, 68, 0.1)',\r\n            border: '1px solid rgba(239, 68, 68, 0.3)',\r\n            borderRadius: 'var(--radius-md)',\r\n            padding: '12px',\r\n            color: 'var(--error)',\r\n            fontSize: '14px',\r\n            marginBottom: '16px',\r\n            textAlign: 'center'\r\n          }}>\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        <div style={{ display: 'flex', gap: '12px' }}>\r\n          <button\r\n            onClick={() => {\r\n              stopScanning();\r\n              onClose();\r\n            }}\r\n            style={{\r\n              flex: 1,\r\n              padding: '12px',\r\n              background: 'var(--glass-bg)',\r\n              border: '1px solid var(--glass-border)',\r\n              borderRadius: 'var(--radius-md)',\r\n              color: 'var(--text-primary)',\r\n              fontSize: '16px',\r\n              fontWeight: '600',\r\n              cursor: 'pointer'\r\n            }}\r\n          >\r\n            Отмена\r\n          </button>\r\n          \r\n          <button\r\n            onClick={() => {\r\n              stopScanning();\r\n              startScanning();\r\n            }}\r\n            style={{\r\n              flex: 1,\r\n              padding: '12px',\r\n              background: 'var(--accent-gradient)',\r\n              border: 'none',\r\n              borderRadius: 'var(--radius-md)',\r\n              color: 'var(--bg-primary)',\r\n              fontSize: '16px',\r\n              fontWeight: '600',\r\n              cursor: 'pointer'\r\n            }}\r\n          >\r\n            Повторить\r\n          </button>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QRScannerModal;\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}