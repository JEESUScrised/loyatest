#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–≤ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ Loya
# –ê–≤—Ç–æ—Ä: Loya Team
# –î–∞—Ç–∞: 15 –æ–∫—Ç—è–±—Ä—è 2024

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–≤ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ Loya..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "package.json" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ Loya"
    exit 1
fi

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
test_frontend() {
    local name=$1
    local port=$2
    local command=$3
    
    echo "üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ $name –Ω–∞ –ø–æ—Ä—Ç—É $port..."
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤ —Ñ–æ–Ω–µ
    (cd "frontends/$name" && timeout 30s $command > /dev/null 2>&1) &
    local pid=$!
    
    # –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞
    sleep 10
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω
    if kill -0 $pid 2>/dev/null; then
        echo "   ‚úÖ $name –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ (PID: $pid)"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞
        if curl -s http://localhost:$port > /dev/null 2>&1; then
            echo "   ‚úÖ $name –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:$port"
        else
            echo "   ‚ö†Ô∏è  $name –∑–∞–ø—É—â–µ–Ω, –Ω–æ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ http://localhost:$port"
        fi
        
        # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å
        kill $pid 2>/dev/null
        wait $pid 2>/dev/null
    else
        echo "   ‚ùå $name –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å"
    fi
    
    echo ""
}

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –ø–æ—Ä—Ç–∞—Ö
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –ø–æ—Ä—Ç–∞—Ö 3001-3004..."
pkill -f "react-scripts\|next dev" 2>/dev/null || true
sleep 2

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ã
test_frontend "client" "3001" "npm start"
test_frontend "cashier" "3002" "npm start"
test_frontend "venue-admin" "3003" "npm start"
test_frontend "tech-admin" "3004" "npm run dev"

echo "üéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:"
echo "   üì± –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:     http://localhost:3001"
echo "   üè™ –ö–∞—Å—Å–∏—Ä—Å–∫–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:     http://localhost:3002"
echo "   üè¢ –ê–¥–º–∏–Ω—Å–∫–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:      http://localhost:3003"
echo "   ‚öôÔ∏è  –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞–¥–º–∏–Ω–∫–∞:    http://localhost:3004"
echo ""
echo "üí° –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ./start-all-frontends.sh"
